<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="ReportServicesBuh" pageWidth="2500" pageHeight="595" orientation="Landscape" whenNoDataType="BlankPage" columnWidth="2480" leftMargin="10" rightMargin="10" topMargin="10" bottomMargin="10" isIgnorePagination="true">
	<property name="ireport.scriptlethandling" value="0"/>
	<property name="ireport.encoding" value="UTF-8"/>
	<property name="ireport.zoom" value="1.6105100000000008"/>
	<property name="ireport.x" value="1618"/>
	<property name="ireport.y" value="0"/>
	<import value="net.sf.jasperreports.engine.*"/>
	<import value="java.util.*"/>
	<import value="net.sf.jasperreports.engine.data.*"/>
	<style name="qqq" mode="Opaque">
		<conditionalStyle>
			<conditionExpression><![CDATA[new Boolean($F{saldo}.doubleValue() < 0)]]></conditionExpression>
			<style mode="Opaque" backcolor="#FF6666"/>
		</conditionalStyle>
	</style>
	<parameter name="contractNumberServices" class="java.lang.String">
		<defaultValueExpression><![CDATA[new String("")]]></defaultValueExpression>
	</parameter>
	<parameter name="ContractDateServicesFrom" class="java.lang.String">
		<defaultValueExpression><![CDATA[new String("01.05.2012")]]></defaultValueExpression>
	</parameter>
	<parameter name="ContractDateServicesTo" class="java.lang.String">
		<defaultValueExpression><![CDATA[new String("31.05.2012")]]></defaultValueExpression>
	</parameter>
	<parameter name="ContragentName" class="java.lang.String">
		<defaultValueExpression><![CDATA[new String("")]]></defaultValueExpression>
	</parameter>
	<parameter name="ContragentOkpo" class="java.lang.String">
		<defaultValueExpression><![CDATA[new String("")]]></defaultValueExpression>
	</parameter>
	<parameter name="ENDepartmentDepartment" class="java.lang.Integer">
		<defaultValueExpression><![CDATA[new Integer(0)]]></defaultValueExpression>
	</parameter>
	<parameter name="ContragentAddress" class="java.lang.String">
		<defaultValueExpression><![CDATA[new String("")]]></defaultValueExpression>
	</parameter>
	<parameter name="ContractNumber" class="java.lang.String">
		<defaultValueExpression><![CDATA[new String("")]]></defaultValueExpression>
	</parameter>
	<parameter name="ContractDateFrom" class="java.lang.String">
		<defaultValueExpression><![CDATA[new String("")]]></defaultValueExpression>
	</parameter>
	<parameter name="ContractDateTo" class="java.lang.String">
		<defaultValueExpression><![CDATA[new String("")]]></defaultValueExpression>
	</parameter>
	<parameter name="PartnerCode" class="java.lang.String">
		<defaultValueExpression><![CDATA[new String("")]]></defaultValueExpression>
	</parameter>
	<parameter name="FinDocCode" class="java.lang.String">
		<defaultValueExpression><![CDATA[new String("")]]></defaultValueExpression>
	</parameter>
	<parameter name="edtCommentGen" class="java.lang.String">
		<defaultValueExpression><![CDATA[new String("")]]></defaultValueExpression>
	</parameter>
	<parameter name="finWorkType" class="java.lang.Integer">
		<defaultValueExpression><![CDATA[new Integer(0)]]></defaultValueExpression>
	</parameter>
	<parameter name="tkclassificationtypecodes" class="java.lang.String">
		<defaultValueExpression><![CDATA[new String("0")]]></defaultValueExpression>
	</parameter>
	<parameter name="showcalcul" class="java.lang.Integer"/>
	<parameter name="isNoPay" class="java.lang.Integer">
		<defaultValueExpression><![CDATA[Integer.MIN_VALUE]]></defaultValueExpression>
	</parameter>
	<parameter name="EnActStart" class="java.lang.String"/>
	<parameter name="EnActFinal" class="java.lang.String"/>
	<queryString>
		<![CDATA[/* послуги на сторону исключая присоединения*/
select  /*q1*/
 actIncodeNumber,
 actIncomeDate ,
 contragentname ,
 depname ,
 FINWorkTypeName ,
 ' '||findoccode as findoccode,
 ' '||partnercode as partnercode,
 ' '||contractnumberservices as contractnumberservices,
 sum(dohod) as dohod ,
 sum(rashod) as rashod ,
 (sum(dohod) - sum(rashod) )::numeric(15,2) as saldo ,
 1 as pr
 , case when sum(rashod) <> 0 then  ((sum(dohod) - sum(rashod) ) /  sum(rashod) * 100 ):: numeric(15,1) else 0 end as rentab
 , elementcode
 , statusname
 ,(select string_agg(to_char(p.datestart,'dd.mm.yyyy'),' , ') from enplanwork p
                where p.elementrefcode = elementcode
                 and  p.kindcode = 4  ) as date_vik_work
 ,  to_char(contractdateservices,'dd.mm.yyyy') as contractdateservices
 ,(select to_char(a.dateact,'dd.mm.yyyy') from enact a
                where a.elementcode  = sooo.elementcode
                 limit 1  ) as dateact
 , dateposting
 , coalesce((select sum(p2so.sumgen) from enpayment2so p2so
			 where p2so.paymenttyperefcode in (1,2)
			 and  p2so.servicesobjectrefcode = sooo.code )
			  ,0)::numeric(15,3) as sum_pay
 , (select t.name from  enservicescontragenttp t, enservicesobject s
                                                 where t.code = s.contragenttyperefcode
                                                 and s.code = sooo.code  ) as contragenttype

from
(
select
/*дата проведения доходного акта */
(select to_char(so2p.dateposting,'dd.mm.yyyy' ) from enservicesobject2prov so2p where so2p.servicesobjectrefcode = soo.code ) AS dateposting ,
(select ss.name from enservicesobjectstatus ss where soo.statusrefcode = ss.code) as statusname,
soo.contragentname  ,
soo.partnercode ,
soo.findoccode ,
soo.contractnumberservices ,
case when soo.calctyperefcode = 1 then -- расчет с методикой без предоплат
          (select coalesce(sum(case when coalesce(p2cltp.calckindrefcode,1) = 2
		then cc.calculationCost
		else cc.costwithoutvat end), 0) from enplanwork p
			inner join enplanwork2classfctntp p2cltp on p.code = p2cltp.planrefcode
			inner join encalctotalcost cc on p2cltp.code = cc.plan2ctyperefcode
          where p.kindcode = 5
          and p.elementrefcode = soo.elementcode )
          +  /*add materialexpenses */
          case when coalesce((select  coalesce(cltp.replacecounterkindcode,0) from encalctotalcost cc  , enplanwork p  , enplanwork2classfctntp p2cltp ,tkclassificationtype cltp
			          where cc.planrefcode = p.code
			          and p.kindcode = 5
			          and p.code = p2cltp.planrefcode
			          and p2cltp.classificationtyperfcd =cltp.code
			          and p.elementrefcode = soo.elementcode
				and coalesce(p2cltp.calckindrefcode, 1) = 2
				and cltp.replacecounterkindcode = 1 limit 1 ),0) = 1 /** замена счетчика */
			  then
	          (select coalesce(sum(cc.materialexpenses),0) from encalctotalcost cc  , enplanwork p
	          where cc.planrefcode = p.code
	          and p.kindcode = 5
	          and p.elementrefcode = soo.elementcode )
          else 0 end
     when soo.calctyperefcode = 2 then  -- расчет по методике с предоплатами
  (select coalesce(sum(a.sumgen),0) from enservicesfactcalc a
    where a.servicesobjectrefcode = soo.code
  ) end /*+ (select coalesce(sum(sci.summa)::numeric(15,2),0)
                 from enservices2clcddtnltms sci where sci.servicesobjectrefcode = soo.code )*/
 dohod  ,

(select coalesce(sum(getsumbyactservicesout(sact.actrefcode , true))::numeric(15,2),0) from
	(select distinct a2p.actrefcode from  enplanwork p, enact2enplanwork a2p
	where p.kindcode = 4
	and p.elementrefcode = soo.elementcode
	and a2p.plancode = p.code
	) sact
) rashod  ,
(select coalesce(to_char(max(a.dategen),'dd.mm.yyyy') ,'') from  enplanwork p, enact2enplanwork a2p , enact a
where p.kindcode = 4
and p.elementrefcode = soo.elementcode
and a2p.plancode = p.code
and a2p.actrefcode = a.code
) actIncomeDate  ,
soo.code ,
soo.elementcode ,
' '||coalesce(contractNumberServices,'') || coalesce('/'||contractNumber,' ') as actIncodeNumber ,
depname ,
( select fwt.name as FINWorkTypeName from  enplanwork2classfctntp pcl , enplanwork pl  ,TKFINWorkType fwt  , tkclassificationtype typ
where pcl.planrefcode = pl.code
and pl.elementrefcode = soo.elementcode
and pl.kindcode = 5
and fwt.code = typ.finworktypecode
and pcl.classificationtyperfcd = typ.code
limit 1 ) as FINWorkTypeName
 , soo.calctyperefcode
 , contractdateservices
from (
Select so.* , dep.name as depname from enservicesobject so, endepartment dep
where so.contracttyperefcode <> 5
and so.findoccode is not null
and case when $P{isNoPay} >= 0 then coalesce(so.isnopay,0) = $P{isNoPay} else 1=1 end
and so.statusrefcode = 2 /*Проведенные в ФК*/
and so.departmentcode = dep.code
and so.contracttyperefcode <> 5
/*номер договора енерджинет */
and case when  trim(REPLACE(lower($P{contractNumberServices}),'*','%')) <> '' then lower(so.contractnumberservices) like trim(REPLACE(lower($P{contractNumberServices}),'*','%')) else 1=1 end
/*фильтр подразделение*/
and case when  $P{ENDepartmentDepartment} <> 0 then
  so.code in (
select distinct  so.code  from  enact2enplanwork a2p , enplanwork p , enservicesobject so
where a2p.plancode = p.code
and p.elementrefcode = so.elementcode
and p.departmentrefcode = $P{ENDepartmentDepartment}
) else 1 = 1 end
/*период SUPP-8011 брать по дате проведения доходного акта */
and case when  $P{ContractDateServicesFrom} <> '' or  $P{ContractDateServicesTo} <> '' then
 so.code in (select distinct  so2p.servicesobjectrefcode  from enservicesobject2prov so2p
            where
            case when $P{ContractDateServicesFrom} = '' and $P{ContractDateServicesTo} = '' then 1 = 1
                 when $P{ContractDateServicesFrom} <> '' and $P{ContractDateServicesTo} <> '' then so2p.dateposting between to_date($P{ContractDateServicesFrom},'dd.mm.yyyy') and  to_date($P{ContractDateServicesTo},'dd.mm.yyyy')
                 when $P{ContractDateServicesFrom} <> '' and $P{ContractDateServicesTo} = '' then so2p.dateposting >= to_date($P{ContractDateServicesFrom},'dd.mm.yyyy')
                 when $P{ContractDateServicesFrom} = '' and $P{ContractDateServicesTo} <> '' then so2p.dateposting <= to_date($P{ContractDateServicesTo},'dd.mm.yyyy')
                  else 1 = 1
            end
            ) else 1 = 1 end
/*название контрагента */
and case when trim($P{ContragentName}) <> '' then lower(so.contragentname)  like trim(REPLACE(lower($P{ContragentName}),'*','%')) else 1=1 end
/*окпо контрагента */
and case when trim($P{ContragentOkpo}) <> '' then so.contragentokpo like trim(REPLACE(lower($P{ContragentOkpo}),'*','%')) else 1=1 end
/*адрес заказчика */
and case when trim($P{ContragentAddress}) <> '' then lower(so.contragentaddress) like  trim(REPLACE(lower($P{ContragentAddress}),'*','%')) else 1=1 end
/*номер договора фин */
and case when trim($P{ContractNumber}) <> '' then lower(so.contractnumber) like trim(REPLACE(lower($P{ContractNumber}),'*','%')) else 1=1 end
/*период договоров фин*/
and case when $P{ContractDateFrom} = '' and $P{ContractDateTo} = '' then 1 = 1
         when $P{ContractDateFrom} <> '' and $P{ContractDateTo} = '' then so.contractdate >= to_date($P{ContractDateFrom},'dd.mm.yyyy')
         when $P{ContractDateFrom} = '' and $P{ContractDateTo} <> '' then so.contractdate <= to_date($P{ContractDateTo},'dd.mm.yyyy')
         when $P{ContractDateFrom} <> '' and $P{ContractDateTo} <> '' then so.contractdate between to_date($P{ContractDateFrom},'dd.mm.yyyy') and  to_date($P{ContractDateTo},'dd.mm.yyyy') else 1 = 1 end

/*код партнера фин*/
and case when trim($P{PartnerCode}) <> '' then lower(so.partnercode) like trim(REPLACE(lower($P{PartnerCode}),'*','%')) else 1=1 end
/*код договра фин*/
and case when trim($P{FinDocCode}) <> '' then lower(so.findoccode) like trim(REPLACE(lower($P{FinDocCode}),'*','%')) else 1=1 end
/*примечание договора фин*/
and case when trim($P{edtCommentGen}) <> '' then lower(so.commentgen) like trim(REPLACE(lower($P{edtCommentGen}),'*','%')) else 1=1 end

and case when $P{finWorkType} <> 0 then so.code in
(select distinct so.code from tkclassificationtype tcl  , enplanwork2classfctntp p2clt , enplanwork p , enservicesobject so
where tcl.finworktypecode = $P{finWorkType}
and p2clt.classificationtyperfcd = tcl.code
and p2clt.planrefcode = p.code
and p.elementrefcode = so.elementcode
and so.contracttyperefcode <> 5
and so.isnopay <> 1
and p.kindcode = 5
 ) else 1 = 1 end
 /*фильтр по калькуляциям в договоре */
 and case when $P{tkclassificationtypecodes} <> '' then  so.code in
    (select distinct so.code from tkclassificationtype tcl  , enplanwork2classfctntp p2clt , enplanwork p , enservicesobject so
    where tcl.kod like replace($P{tkclassificationtypecodes},'*','%')
         and p2clt.classificationtyperfcd = tcl.code
         and p2clt.planrefcode = p.code
         and p.elementrefcode = so.elementcode
         and p.kindcode = 5
   ) else 1 = 1 end
 and  /*фільтрація по даті проведення видаткового акту*/
 case when ( $P{EnActStart} <> '' and $P{EnActFinal} <> '' ) then
      ( select a.dategen  from enact a where a.elementcode = so.elementcode limit 1 ) between to_date($P{EnActStart} ,'dd.mm.yyyy')  and to_date($P{EnActFinal} ,'dd.mm.yyyy') else 1=1 end

) soo
) sooo
group by sooo.code , contragentname , findoccode , partnercode , contractnumberservices , actIncodeNumber , actIncomeDate ,depname , FINWorkTypeName,statusname,elementcode , contractdateservices ,  dateposting

UNION all /*q2*/

/*послуги приєднання новая методика , скручивается с сервис обжектом и котнратгент тип = 5 */
Select
actIncodeNumber,
actIncomeDate ,
contragentname ,
depname ,
FINWorkTypeName as FINWorkTypeName ,
findoccode ,
partnercode ,
contractnumber as contractnumberservices ,
sum(dohod) as dohod ,
sum(rashod) as rashod ,
(sum(dohod) - sum(rashod) )::numeric(15,2) as saldo ,
2 as pr
 , case when sum(rashod) <> 0 then  ((sum(dohod) - sum(rashod) ) /  sum(rashod) * 100 ):: numeric(15,1) else 0 end as rentab
 , elementcode
 , statusname
 ,(select string_agg(to_char(p.datestart,'dd.mm.yyyy'),' , ') from enplanwork p
                where p.elementrefcode = elementcode
                 and  p.kindcode = 4  ) as date_vik_work
 ,  to_char(contractdateservices,'dd.mm.yyyy') as contractdateservices
 ,(select to_char(a.dateact,'dd.mm.yyyy') from enact a
                where a.elementcode  = spr.elementcode
                 limit 1  ) as dateact
, dateposting
, coalesce((select sum(p2so.sumgen) from enpayment2so p2so , enservicesobject soo
			 where p2so.paymenttyperefcode in (1,2)
			 and  p2so.servicesobjectrefcode = soo.code
			 and  soo.elementcode  = elementcode )
			  ,0)::numeric(15,3) as sum_pay
, (select t.name from  enservicescontragenttp t, enservicesobject s
                                                 where t.code = s.contragenttyperefcode
                                                 and s.elementcode = elementcode  ) as contragenttype

From (
Select
/*дата проведения доходного акта */
(select to_char(so2p.dateposting,'dd.mm.yyyy') from enservicesobject2prov so2p where so2p.servicesobjectrefcode = so.code ) AS dateposting ,
(select ss.name from enservicesobjectstatus ss where so.statusrefcode = ss.code) as statusname,
' '||ts.contractnumber as contractnumber ,
ts.partnername as contragentname ,
' '||ts.fincontractnumber as findoccode ,
' '||ts.partnercode as partnercode ,
so.elementcode  , /*елемент брать из сервис обжекта  */
ts.code ,
coalesce(( select sum(ait.summagen-ait.summavat::numeric(15,2)) from  ENACTINCOMETECHCONDTNS ait
where ait.techcondservicesrefcod = ts.code
and ait.statusrefcode = 3 /*проведенный */
),0) as dohod  ,
coalesce((select coalesce(sum(get_sum_by_act_services2(aa2pp.actrefcode)),0)
from
(
 select  distinct a2p.actrefcode from  ENTECHCOND2PLANWORK  tpl  , enact2enplanwork a2p , enact a
where tpl.techconservicesrefcode = ts.code
and tpl.planrefcode = a2p.plancode
and a.code = a2p.actrefcode
and a.statusrefcode = 3 /*проведенный*/
union
/*учитываем акты по проектным работы по приеднанню*/
select distinct a2p.actrefcode from  enplanwork p, enact2enplanwork a2p , enact a
where p.kindcode = 4
and p.elementrefcode = so.elementcode
and a2p.plancode = p.code
and a.code = a2p.actrefcode
and a.statusrefcode = 3 /*проведенный*/
) aa2pp
),0) as rashod
 ,
( select group_concat(ait.numbergen,',') from  ENACTINCOMETECHCONDTNS ait
where ait.techcondservicesrefcod = ts.code
  and ait.statusrefcode = 3 /*проведенный */
) as actIncodeNumber  ,
( select group_concat(to_char(ait.dategen,'dd.mm.yyyy'),',')  from  ENACTINCOMETECHCONDTNS ait
where ait.techcondservicesrefcod = ts.code
and ait.statusrefcode = 3 /*проведенный */
) as actIncomeDate
, dep.name as depname
, ( select fwt.name as FINWorkTypeName from ENTECHCOND2PLANWORK t2p ,  enplanwork pl  ,TKFINWorkType fwt  ,
tkclassificationtype typ , enplanworkitem pi , tktechcard tkd
where t2p.techconservicesrefcode = ts.code
and t2p.planrefcode = pl.code
and fwt.code = typ.finworktypecode
and pl.code = pi.planrefcode
and pi.kartarefcode = tkd.code
and tkd.classificationtypecode = typ.code
limit 1 ) as FINWorkTypeName
, so.contractdateservices

FROM  entechconditionsservcs ts , endepartment dep , enservicesobject2techcondtnsservices s2t  , enservicesobject so ,
      enservicesobjectstatus sostatus
where ts.findoccode is not null
and ts.departmentcode = dep.code
and ts.code = s2t.techcondservrefcode
and so.code = s2t.servicesobjectrefcode
and so.contracttyperefcode = 5
and sostatus.code = so.statusrefcode
and case when $P{isNoPay} >= 0 then coalesce(so.isnopay,0) = $P{isNoPay} else 1=1 end
and so.statusrefcode = 2 /*Проведенные в ФК*/
and 1 = 2 /* SUPP-8687  исключаем из этого отчета договора по новой методике (сделан отдельный отчет)*/
/*выберем только те договора по которым был проведенный расходный акт */
and ts.code in (
select distinct  t2p.techconservicesrefcode  from enact a  , enact2enplanwork a2p , enplanwork p , ENTECHCOND2PLANWORK t2p
where a.statusrefcode = 3
and a.code = a2p.actrefcode
and a2p.plancode = p.code
and p.code = t2p.planrefcode
and t2p.techconservicesrefcode is not null
)
/*номер договора енерджинет */
and case when  trim(REPLACE(lower($P{contractNumberServices}),'*','%')) <> '' then lower(ts.contractnumber) like trim(REPLACE(lower($P{contractNumberServices}),'*','%')) else 1=1 end
/*подразделение берем из договора */
and case when $P{ENDepartmentDepartment} <> 0 then ts.departmentcode = $P{ENDepartmentDepartment} else 1 = 1 end
/*период SUPP-8011 брать по дате проведения доходного акта */
and case when  $P{ContractDateServicesFrom} <> '' or  $P{ContractDateServicesTo} <> '' then
 so.code in (select distinct  so2p.servicesobjectrefcode  from enservicesobject2prov so2p
            where
            case when $P{ContractDateServicesFrom} = '' and $P{ContractDateServicesTo} = '' then 1 = 1
                 when $P{ContractDateServicesFrom} <> '' and $P{ContractDateServicesTo} <> '' then so2p.dateposting between to_date($P{ContractDateServicesFrom},'dd.mm.yyyy') and  to_date($P{ContractDateServicesTo},'dd.mm.yyyy')
                 when $P{ContractDateServicesFrom} <> '' and $P{ContractDateServicesTo} = '' then so2p.dateposting >= to_date($P{ContractDateServicesFrom},'dd.mm.yyyy')
                 when $P{ContractDateServicesFrom} = '' and $P{ContractDateServicesTo} <> '' then so2p.dateposting <= to_date($P{ContractDateServicesTo},'dd.mm.yyyy')
                  else 1 = 1
            end
            ) else 1 = 1 end
/* конец период договоров >> */
/*название контрагента */
and case when trim($P{ContragentName}) <> '' then lower(ts.partnername)  like trim(REPLACE(lower($P{ContragentName}),'*','%')) else 1=1 end
/*окпо контрагента */
and case when trim($P{ContragentOkpo}) <> ''   then
   ts.code in ( select distinct cnt.techcondservicesrefcod from encontragent cnt where cnt.contragentokpo like trim(REPLACE(lower($P{ContragentOkpo}),'*','%'))  )
else 1=1 end
/*адрес заказчика */
 and  ( case when trim($P{ContragentAddress}) <> '' then
   ts.code in ( select distinct cnt2.techcondservicesrefcod from encontragent cnt2 where lower(cnt2.contragentaddress) like
                trim(REPLACE(lower($P{ContragentAddress} ),'*','%')) )
 else 1=1 end )
 /*номер договора фин */
and case when trim($P{ContractNumber}) <> '' then lower(ts.fincontractnumber) like trim(REPLACE(lower($P{ContractNumber}),'*','%')) else 1=1 end
/*период договоров фин*/
and case when $P{ContractDateFrom} = '' and $P{ContractDateTo} = '' then 1 = 1
         when $P{ContractDateFrom}  <> '' and $P{ContractDateTo} = '' then ts.fincontractdate >= to_date($P{ContractDateFrom},'dd.mm.yyyy')
         when $P{ContractDateFrom}  = '' and $P{ContractDateTo} <> '' then ts.fincontractdate <= to_date($P{ContractDateTo},'dd.mm.yyyy')
         when $P{ContractDateFrom}  <> '' and $P{ContractDateTo} <> '' then ts.fincontractdate between to_date($P{ContractDateFrom},'dd.mm.yyyy') and  to_date($P{ContractDateTo},'dd.mm.yyyy') else 1 = 1 end

/*код партнера фин*/
and case when trim($P{PartnerCode}) <> '' then lower(ts.partnercode) like trim(REPLACE(lower($P{PartnerCode}),'*','%')) else 1=1 end
/*код договра фин*/
and case when trim($P{FinDocCode}) <> '' then lower(ts.findoccode) like trim(REPLACE(lower($P{FinDocCode}),'*','%')) else 1=1 end
/*примечание договора фин*/
and case when trim($P{edtCommentGen}) <> '' then lower(ts.fincommentgen) like trim(REPLACE(lower($P{edtCommentGen}),'*','%')) else 1=1 end
/*код работ из услуг*/
and case when $P{finWorkType} <> 0 then ts.code in
( select t2p.techconservicesrefcode as FINWorkTypeName from ENTECHCOND2PLANWORK t2p ,  enplanwork pl  ,TKFINWorkType fwt  ,
tkclassificationtype typ , enplanworkitem pi , tktechcard tkd
where t2p.planrefcode = pl.code
and fwt.code = typ.finworktypecode
and pl.code = pi.planrefcode
and pi.kartarefcode = tkd.code
and tkd.classificationtypecode = typ.code
and typ.finworktypecode = $P{finWorkType} ) else 1 = 1 end

/*фильтр по калькуляциям в договоре */
 and case when $P{tkclassificationtypecodes} <> '' then  so.code in
    (select distinct so.code from tkclassificationtype tcl  , enplanwork2classfctntp p2clt , enplanwork p , enservicesobject so
    where tcl.kod like replace($P{tkclassificationtypecodes},'*','%')
         and p2clt.classificationtyperfcd = tcl.code
         and p2clt.planrefcode = p.code
         and p.elementrefcode = so.elementcode
         and p.kindcode = 5
   ) else 1 = 1 end

   and  /*фільтрація по даті проведення видаткового акту*/
 case when ( $P{EnActStart} <> '' and $P{EnActFinal} <> '' ) then
      ( select a.dategen from enact a where a.elementcode = so.elementcode limit 1 ) between to_date($P{EnActStart},'dd.mm.yyyy')  and to_date($P{EnActFinal},'dd.mm.yyyy') else 1=1 end

) spr
Group by contragentname , findoccode , partnercode   , actIncodeNumber , actIncomeDate  , depname , FINWorkTypeName , contractnumber, elementcode , statusname, contractdateservices , dateposting

UNION ALL

/*послуги приєднання старая методика */
select   /*q3*/
actIncodeNumber,
actIncomeDate ,
contragentname ,
depname ,
FINWorkTypeName as FINWorkTypeName ,
findoccode ,
partnercode ,
contractnumber as contractnumberservices ,
sum(dohod) as dohod ,
sum(rashod) as rashod ,
(sum(dohod) - sum(rashod) )::numeric(15,2) as saldo ,
2 as pr
 , case when sum(rashod) <> 0 then  ((sum(dohod) - sum(rashod) ) /  sum(rashod) * 100 ):: numeric(15,1) else 0 end as rentab
 ,elementcode
 ,statusname /*статус из течкондишн*/
 ,(select string_agg(to_char(p.datestart,'dd.mm.yyyy'),' , ') from enplanwork p
                where p.elementrefcode = elementcode
                 and  p.kindcode = 4  ) as date_vik_work
 ,  to_char(contractdateservices,'dd.mm.yyyy') as contractdateservices
 ,(select to_char(a.dateact,'dd.mm.yyyy') from enact a
                where a.elementcode  = spr.elementcode
                 limit 1  ) as dateact

 , dateposting
 , coalesce((select sum(p2so.sumgen) from enpayment2so p2so , enservicesobject soo
			 where p2so.paymenttyperefcode in (1,2)
			 and  p2so.servicesobjectrefcode = soo.code
			 and  soo.elementcode  = elementcode )
			  ,0)::numeric(15,3) as sum_pay
, (select t.name from  enservicescontragenttp t, enservicesobject s
                                                 where t.code = s.contragenttyperefcode
                                                 and s.elementcode = elementcode  ) as contragenttype
From (
Select
(select qq.name as statusname from  entechcondtnssrvcsstts qq where ts.techcondservicessttscd = qq.code  ) as statusname ,
' '||ts.contractnumber as contractnumber ,
ts.partnername as contragentname ,
' '||ts.fincontractnumber as findoccode ,
' '||ts.partnercode as partnercode ,
ts.elementcode  ,
ts.code ,
coalesce(( select sum(ait.summagen-ait.summavat::numeric(15,2)) from  ENACTINCOMETECHCONDTNS ait
where ait.techcondservicesrefcod = ts.code
and ait.statusrefcode = 3 /*проведенный */
),0) as dohod  ,
coalesce((select coalesce(sum(get_sum_by_act_services2(aa2pp.actrefcode)),0)
from
(
 select  distinct a2p.actrefcode from  ENTECHCOND2PLANWORK  tpl  , enact2enplanwork a2p , enact a
where tpl.techconservicesrefcode = ts.code
and tpl.planrefcode = a2p.plancode
and a.code = a2p.actrefcode
and a.statusrefcode = 3 /*проведенный*/
) aa2pp
),0) as rashod
 ,
( select group_concat(ait.numbergen,',') from  ENACTINCOMETECHCONDTNS ait
where ait.techcondservicesrefcod = ts.code
  and ait.statusrefcode = 3 /*проведенный */
) as actIncodeNumber  ,
( select group_concat(to_char(ait.dategen,'dd.mm.yyyy'),',')  from  ENACTINCOMETECHCONDTNS ait
where ait.techcondservicesrefcod = ts.code
and ait.statusrefcode = 3 /*проведенный */
) as actIncomeDate
, dep.name as depname
, ( select fwt.name as FINWorkTypeName from ENTECHCOND2PLANWORK t2p ,  enplanwork pl  ,TKFINWorkType fwt  ,
tkclassificationtype typ , enplanworkitem pi , tktechcard tkd
where t2p.techconservicesrefcode = ts.code
and t2p.planrefcode = pl.code
and fwt.code = typ.finworktypecode
and pl.code = pi.planrefcode
and pi.kartarefcode = tkd.code
and tkd.classificationtypecode = typ.code
limit 1 ) as FINWorkTypeName
, ts.contractdate as  contractdateservices
,( select group_concat(to_char(ait.dategen,'dd.mm.yyyy'),',')  from  ENACTINCOMETECHCONDTNS ait
where ait.techcondservicesrefcod = ts.code
and ait.statusrefcode = 3 /*проведенный */
) as dateposting
FROM  entechconditionsservcs ts , endepartment dep , enactincometechcondtns aincom
where ts.findoccode is not null
and ts.departmentcode = dep.code
and  $P{isNoPay} in (-1,0) /*эти договора могут быть только платными*/
and ts.techcondservicessttscd = 3 /*завершенный */
and ts.code = aincom.techcondservicesrefcod
/*выберем только те договора по которым был проведенный расходный акт */
and ts.code in (
select distinct  t2p.techconservicesrefcode  from enact a  , enact2enplanwork a2p , enplanwork p , ENTECHCOND2PLANWORK t2p
where a.statusrefcode = 3
and a.code = a2p.actrefcode
and a2p.plancode = p.code
and p.code = t2p.planrefcode
and t2p.techconservicesrefcode is not null
)
/*номер договора енерджинет */
and case when  trim(REPLACE(lower($P{contractNumberServices}),'*','%')) <> '' then lower(ts.contractnumber) like trim(REPLACE(lower($P{contractNumberServices}),'*','%')) else 1=1 end
/*подразделение берем из договора */
and case when $P{ENDepartmentDepartment} <> 0 then ts.departmentcode = $P{ENDepartmentDepartment} else 1 = 1 end
/*период договоров енерджинет*/
and case when  $P{ContractDateServicesFrom} <> '' or  $P{ContractDateServicesTo} <> '' then
  ts.code in (
select distinct  aincom.techcondservicesrefcod from enactincometechcondtns aincom
where
  case when $P{ContractDateServicesFrom} = '' and $P{ContractDateServicesTo} = '' then 1 = 1
       when $P{ContractDateServicesFrom} <> '' and $P{ContractDateServicesTo}  <> '' then aincom.dategen between to_date($P{ContractDateServicesFrom},'dd.mm.yyyy') and  to_date($P{ContractDateServicesTo},'dd.mm.yyyy')
       when $P{ContractDateServicesFrom} <> '' and $P{ContractDateServicesTo} = '' then aincom.dategen >= to_date($P{ContractDateServicesFrom},'dd.mm.yyyy')
       when $P{ContractDateServicesFrom} = '' and $P{ContractDateServicesTo}  <> '' then aincom.dategen <= to_date($P{ContractDateServicesTo},'dd.mm.yyyy')
        else 1 = 1
  end
)
else 1 = 1 end
/* конец период договоров >> */
/*название контрагента */
and case when trim($P{ContragentName}) <> '' then lower(ts.partnername)  like trim(REPLACE(lower($P{ContragentName}),'*','%')) else 1=1 end
/*окпо контрагента */
and case when trim($P{ContragentOkpo}) <> ''   then
   ts.code in ( select distinct cnt.techcondservicesrefcod from encontragent cnt where cnt.contragentokpo like trim(REPLACE(lower($P{ContragentOkpo}),'*','%'))  )
else 1=1 end
/*адрес заказчика */
 and  ( case when trim($P{ContragentAddress}) <> '' then
   ts.code in ( select distinct cnt2.techcondservicesrefcod from encontragent cnt2 where lower(cnt2.contragentaddress) like
                trim(REPLACE(lower($P{ContragentAddress} ),'*','%')) )
 else 1=1 end )
 /*номер договора фин */
and case when trim($P{ContractNumber}) <> '' then lower(ts.fincontractnumber) like trim(REPLACE(lower($P{ContractNumber}),'*','%')) else 1=1 end
/*период договоров фин*/
and case when $P{ContractDateFrom} = '' and $P{ContractDateTo} = '' then 1 = 1
         when $P{ContractDateFrom}  <> '' and $P{ContractDateTo} = '' then ts.fincontractdate >= to_date($P{ContractDateFrom},'dd.mm.yyyy')
         when $P{ContractDateFrom}  = '' and $P{ContractDateTo} <> '' then ts.fincontractdate <= to_date($P{ContractDateTo},'dd.mm.yyyy')
         when $P{ContractDateFrom}  <> '' and $P{ContractDateTo} <> '' then ts.fincontractdate between to_date($P{ContractDateFrom},'dd.mm.yyyy') and  to_date($P{ContractDateTo},'dd.mm.yyyy') else 1 = 1 end

/*код партнера фин*/
and case when trim($P{PartnerCode}) <> '' then lower(ts.partnercode) like trim(REPLACE(lower($P{PartnerCode}),'*','%')) else 1=1 end
/*код договра фин*/
and case when trim($P{FinDocCode}) <> '' then lower(ts.findoccode) like trim(REPLACE(lower($P{FinDocCode}),'*','%')) else 1=1 end
/*примечание договора фин*/
and case when trim($P{edtCommentGen}) <> '' then lower(ts.fincommentgen) like trim(REPLACE(lower($P{edtCommentGen}),'*','%')) else 1=1 end
/*код работ из услуг*/
and case when $P{finWorkType} <> 0 then ts.code in
( select t2p.techconservicesrefcode as FINWorkTypeName from ENTECHCOND2PLANWORK t2p ,  enplanwork pl  ,TKFINWorkType fwt  ,
tkclassificationtype typ , enplanworkitem pi , tktechcard tkd
where t2p.planrefcode = pl.code
and fwt.code = typ.finworktypecode
and pl.code = pi.planrefcode
and pi.kartarefcode = tkd.code
and tkd.classificationtypecode = typ.code
and typ.finworktypecode = $P{finWorkType} ) else 1 = 1 end
/*исключая новые договора на присоединение*/
and ts.code not in (select techcondservrefcode from enservicesobject2techcondtnsservices  )
/*фильтр по калькуляциям*/
and case when $P{tkclassificationtypecodes} <> '' then ts.code in
( select t2p.techconservicesrefcode  from ENTECHCOND2PLANWORK t2p ,  enplanwork pl  ,TKFINWorkType fwt  ,
    tkclassificationtype typ , enplanworkitem pi , tktechcard tkd
    where t2p.planrefcode = pl.code
    and fwt.code = typ.finworktypecode
    and pl.code = pi.planrefcode
    and pi.kartarefcode = tkd.code
    and tkd.classificationtypecode = typ.code
    and typ.kod like replace($P{tkclassificationtypecodes},'*','%')  ) else 1 = 1 end

  and  /*фільтрація по даті проведення видаткового акту*/
  case when ( $P{EnActStart} <> '' and $P{EnActFinal} <> '' ) then
  (
    select a.dategen from  ENTECHCOND2PLANWORK  tpl  , enact2enplanwork a2p , enact a
	where tpl.techconservicesrefcode = ts.code
	and tpl.planrefcode = a2p.plancode
	and a.code = a2p.actrefcode
	limit 1
	)  between to_date($P{EnActStart},'dd.mm.yyyy')  and to_date($P{EnActFinal},'dd.mm.yyyy') else 1=1 end

) spr
Group by contragentname , findoccode , partnercode   , actIncodeNumber , actIncomeDate  , depname , FINWorkTypeName , contractnumber,elementcode ,statusname , contractdateservices , dateposting

 /* послуги по договорам на ТО та ремонт */
UNION ALL

select  /*q4*/
actIncodeNumber ,
actIncomeDate ,
contragentname ,
depname ,
FINWorkTypeName ,
findoccode ,
partnercode ,
contractnumber ,
dohod ,
rashod ,
(dohod - rashod)::numeric(15,2) as saldo ,
3 as pr
, case when rashod <> 0 then  ((dohod - rashod ) /  rashod * 100 ):: numeric(15,1) else 0 end as rentab
,0 as elementcode
,'' as statusname
, '' as date_vik_work
 , to_char(contractdateservices,'dd.mm.yyyy') as contractdateservices
 ,' ' as dateact
 , dateposting
  , 0 as sum_pay
  , '' as contragenttype
from (
select
     ' '|| ai.numbergen as  actIncodeNumber ,
   to_char(ai.dategen,'dd.mm.yyyy') as actIncomeDate ,
   ai.partnername  as contragentname ,
   ( select distinct dep.name  from endepartment dep  , enactincome2enact ai2a  , enact2enplanwork a2p, enplanwork p
   where ai2a.actincomerefcode = ai.code
   and a2p.actrefcode = ai2a.actrefcode
   and a2p.plancode = p.code
   and p.departmentrefcode = dep.code
   limit 1
    ) as depname ,
     ( select fwt.name as FINWorkTypeName from  enactincome2enact ai2a  , enact2enplanwork a2p,  enplanwork pl  ,TKFINWorkType fwt  ,
tkclassificationtype typ , enplanworkitem pi , tktechcard tkd
where ai2a.actincomerefcode = ai.code
   and a2p.actrefcode = ai2a.actrefcode
   and a2p.plancode = pl.code
   and fwt.code = typ.finworktypecode
   and pl.code = pi.planrefcode
   and pi.kartarefcode = tkd.code
   and tkd.classificationtypecode = typ.code
limit 1 ) as FINWorkTypeName ,
ai.findoccode ,
ai.partnercode ,
ai.contractnumber ,
 ( select coalesce(sum(get_sum_by_act(a.code)),0) from ENACTINCOME2ENACT aii , enact a
 where aii.actincomerefcode = ai.code
 and a.code  = aii.actrefcode  ) as dohod  ,
  ( select coalesce(sum(get_sum_by_act(a.code)),0) from ENACTINCOME2ENACT aii , enact a
 where aii.actincomerefcode = ai.code
 and a.code  = aii.actrefcode  ) as rashod
, ai.dategen as contractdateservices
, to_char(ai.dategen,'dd.mm.yyyy') as dateposting
from enactincome ai
where ai.statusrefcode = 3
/*номер договора енерджинет */
and case when  trim(REPLACE(lower($P{contractNumberServices}),'*','%')) <> '' then lower(ai.contractnumber) like trim(REPLACE(lower($P{contractNumberServices}),'*','%')) else 1=1 end
/*период  из доходного акта  */
and case when  $P{ContractDateServicesFrom} <> '' or  $P{ContractDateServicesTo} <> '' then
  ai.code in (
select distinct  ai.code from  enactincome ai
where
  case when $P{ContractDateServicesFrom} = '' and $P{ContractDateServicesTo} = '' then 1 = 1
       when $P{ContractDateServicesFrom} <> '' and $P{ContractDateServicesTo}  <> '' then ai.dategen between to_date($P{ContractDateServicesFrom},'dd.mm.yyyy') and  to_date($P{ContractDateServicesTo},'dd.mm.yyyy')
       when $P{ContractDateServicesFrom} <> '' and $P{ContractDateServicesTo} = '' then ai.dategen >= to_date($P{ContractDateServicesFrom},'dd.mm.yyyy')
       when $P{ContractDateServicesFrom} = '' and $P{ContractDateServicesTo}  <> '' then ai.dategen <= to_date($P{ContractDateServicesTo},'dd.mm.yyyy')
        else 1 = 1
  end
)
else 1 = 1 end
/* конец период договоров >> */
/*название контрагента */
and case when trim($P{ContragentName}) <> '' then lower(ai.partnername)  like trim(REPLACE(lower($P{ContragentName}),'*','%')) else 1=1 end
/*подразделение из планов */
and case when $P{ENDepartmentDepartment} <> 0
then ai.code in (
 select distinct ai2a.actincomerefcode  from endepartment dep  , enactincome2enact ai2a  , enact2enplanwork a2p, enplanwork p
   where a2p.actrefcode = ai2a.actrefcode
   and a2p.plancode = p.code
   and p.departmentrefcode = dep.code
   and dep.code =  $P{ENDepartmentDepartment}
   )

else 1 = 1 end
/*номер договора фин */
and case when trim($P{ContractNumber}) <> '' then lower(ai.contractnumber ) like trim(REPLACE(lower($P{ContractNumber}),'*','%')) else 1=1 end
/*период договоров фин*/
and case when $P{ContractDateFrom} = '' and $P{ContractDateTo} = '' then 1 = 1
         when $P{ContractDateFrom}  <> '' and $P{ContractDateTo} = '' then ai.contractdate >= to_date($P{ContractDateFrom},'dd.mm.yyyy')
         when $P{ContractDateFrom}  = '' and $P{ContractDateTo} <> '' then ai.contractdate <= to_date($P{ContractDateTo},'dd.mm.yyyy')
         when $P{ContractDateFrom}  <> '' and $P{ContractDateTo} <> '' then ai.contractdate between to_date($P{ContractDateFrom},'dd.mm.yyyy') and  to_date($P{ContractDateTo},'dd.mm.yyyy') else 1 = 1 end
/*код партнера фин*/
and case when trim($P{PartnerCode}) <> '' then lower(ai.partnercode) like trim(REPLACE(lower($P{PartnerCode}),'*','%')) else 1=1 end
/*код договра фин*/
and case when trim($P{FinDocCode}) <> '' then lower(ai.findoccode) like trim(REPLACE(lower($P{FinDocCode}),'*','%')) else 1=1 end

and $P{tkclassificationtypecodes} = '' /*доходные акты выбираем если не указаны калькуляции*/
and $P{isNoPay} in (-1, 0)

	and  /*фільтрація по даті проведення видаткового акту*/
	 case when ( $P{EnActStart} <> '' and $P{EnActFinal} <> '' ) then
	( select a.dategen from ENACTINCOME2ENACT aii , enact a
	 where aii.actincomerefcode = ai.code
	 and a.code  = aii.actrefcode  limit 1 ) between to_date( $P{EnActStart} ,'dd.mm.yyyy')  and  to_date($P{EnActFinal} ,'dd.mm.yyyy')  else 1=1 end

) as sel1
order by pr ,  findoccode , contragentname

 ]]>
	</queryString>
	<field name="actincodenumber" class="java.lang.String"/>
	<field name="actincomedate" class="java.lang.String"/>
	<field name="contragentname" class="java.lang.String"/>
	<field name="depname" class="java.lang.String"/>
	<field name="finworktypename" class="java.lang.String"/>
	<field name="findoccode" class="java.lang.String"/>
	<field name="partnercode" class="java.lang.String"/>
	<field name="contractnumberservices" class="java.lang.String"/>
	<field name="dohod" class="java.math.BigDecimal"/>
	<field name="rashod" class="java.math.BigDecimal"/>
	<field name="saldo" class="java.math.BigDecimal"/>
	<field name="rentab" class="java.math.BigDecimal"/>
	<field name="elementcode" class="java.lang.Integer"/>
	<field name="statusname" class="java.lang.String"/>
	<field name="date_vik_work" class="java.lang.String"/>
	<field name="contractdateservices" class="java.lang.String"/>
	<field name="dateact" class="java.lang.String"/>
	<field name="dateposting" class="java.lang.String"/>
	<field name="sum_pay" class="java.math.BigDecimal"/>
	<field name="contragenttype" class="java.lang.String"/>
	<variable name="itog_dohod" class="java.math.BigDecimal" calculation="Sum">
		<variableExpression><![CDATA[$F{dohod}]]></variableExpression>
		<initialValueExpression><![CDATA[new BigDecimal(0)]]></initialValueExpression>
	</variable>
	<variable name="itog_rashod" class="java.math.BigDecimal" calculation="Sum">
		<variableExpression><![CDATA[$F{rashod}]]></variableExpression>
		<initialValueExpression><![CDATA[new BigDecimal(0)]]></initialValueExpression>
	</variable>
	<variable name="itog_saldo" class="java.math.BigDecimal" calculation="Sum">
		<variableExpression><![CDATA[$F{saldo}]]></variableExpression>
		<initialValueExpression><![CDATA[new BigDecimal(0)]]></initialValueExpression>
	</variable>
	<group name="pol">
		<groupExpression><![CDATA[$F{actincodenumber}]]></groupExpression>
		<groupHeader>
			<band splitType="Stretch"/>
		</groupHeader>
		<groupFooter>
			<band splitType="Stretch"/>
		</groupFooter>
	</group>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="50" splitType="Stretch">
			<textField isBlankWhenNull="false">
				<reportElement key="textField-1" x="110" y="12" width="576" height="29"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Times New Roman" size="12" pdfFontName="times.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
				</textElement>
				<textFieldExpression><![CDATA[" Звіт по послугам на сторону "]]></textFieldExpression>
			</textField>
		</band>
	</title>
	<pageHeader>
		<band splitType="Stretch"/>
	</pageHeader>
	<columnHeader>
		<band height="50" splitType="Stretch">
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField-7" positionType="Float" stretchType="RelativeToTallestObject" mode="Transparent" x="450" y="0" width="236" height="50" forecolor="#000000" backcolor="#FFFFFF"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="10" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA["Контрагент"]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField-8" positionType="Float" stretchType="RelativeToTallestObject" mode="Transparent" x="220" y="0" width="60" height="50" forecolor="#000000" backcolor="#FFFFFF"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="10" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA["Договір EnergyNET"]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField-9" positionType="Float" stretchType="RelativeToTallestObject" mode="Transparent" x="1016" y="0" width="60" height="50" forecolor="#000000" backcolor="#FFFFFF"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="10" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA["Доход(без ПДВ)"]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField-10" positionType="Float" stretchType="RelativeToTallestObject" mode="Transparent" x="1076" y="0" width="60" height="50" forecolor="#000000" backcolor="#FFFFFF"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="10" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA["Расход(без ПДВ)"]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField-11" positionType="Float" stretchType="RelativeToTallestObject" mode="Transparent" x="1136" y="0" width="60" height="50" forecolor="#000000" backcolor="#FFFFFF"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="10" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA["Фін. результат"]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField-15" positionType="Float" stretchType="RelativeToTallestObject" mode="Transparent" x="390" y="0" width="60" height="50" forecolor="#000000" backcolor="#FFFFFF"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="10" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA["Код контрагента Фін."]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField-17" positionType="Float" stretchType="RelativeToTallestObject" mode="Transparent" x="0" y="0" width="60" height="50" forecolor="#000000" backcolor="#FFFFFF"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="10" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA["№ прибуткового акта"]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField-19" positionType="Float" stretchType="RelativeToTallestObject" mode="Transparent" x="60" y="0" width="50" height="50" forecolor="#000000" backcolor="#FFFFFF"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="10" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA["Дата прибуткового акта"]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField-21" positionType="Float" stretchType="RelativeToTallestObject" mode="Transparent" x="330" y="0" width="60" height="50" forecolor="#000000" backcolor="#FFFFFF"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="10" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA["Договір Фін."]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField-23" positionType="Float" stretchType="RelativeToTallestObject" mode="Transparent" x="686" y="0" width="100" height="50" forecolor="#000000" backcolor="#FFFFFF"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="10" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA["Підрозділ"]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField-25" positionType="Float" stretchType="RelativeToTallestObject" mode="Transparent" x="786" y="0" width="230" height="50" forecolor="#000000" backcolor="#FFFFFF"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="10" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA["Вид робіт з послуг"]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField-11" positionType="Float" stretchType="RelativeToTallestObject" mode="Transparent" x="1196" y="0" width="80" height="50" forecolor="#000000" backcolor="#FFFFFF"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="10" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA["Рентабельність(%)"]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField-11" positionType="Float" stretchType="RelativeToTallestObject" mode="Transparent" x="1625" y="0" width="405" height="50" forecolor="#000000" backcolor="#FFFFFF">
					<printWhenExpression><![CDATA[new Boolean($P{showcalcul}.intValue() == 1 )]]></printWhenExpression>
				</reportElement>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="10" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA["Назва калькуляції"]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField-11" positionType="Float" stretchType="RelativeToTallestObject" mode="Transparent" x="1565" y="0" width="60" height="50" forecolor="#000000" backcolor="#FFFFFF">
					<printWhenExpression><![CDATA[new Boolean($P{showcalcul}.intValue() == 1 )]]></printWhenExpression>
				</reportElement>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="10" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA["Код калькуляції"]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField-11" positionType="Float" stretchType="RelativeToTallestObject" mode="Transparent" x="1276" y="0" width="80" height="50" forecolor="#000000" backcolor="#FFFFFF"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="10" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA["бух. статус"]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField-19" positionType="Float" stretchType="RelativeToTallestObject" mode="Transparent" x="170" y="0" width="50" height="50" forecolor="#000000" backcolor="#FFFFFF"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="10" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA["Дата виконання робіт"]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField-19" positionType="Float" stretchType="RelativeToTallestObject" mode="Transparent" x="280" y="0" width="50" height="50" forecolor="#000000" backcolor="#FFFFFF"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="10" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA["Дата укладення Договору EnergyNET"]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField-11" positionType="Float" stretchType="RelativeToTallestObject" mode="Transparent" x="1356" y="0" width="89" height="50" forecolor="#000000" backcolor="#FFFFFF"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="10" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA["Дата видаткового акта"]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField-19" positionType="Float" stretchType="RelativeToTallestObject" mode="Transparent" x="110" y="0" width="60" height="50" forecolor="#000000" backcolor="#FFFFFF"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="10" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA["Дата проведення прибуткового акта"]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField-11" positionType="Float" stretchType="RelativeToTallestObject" mode="Transparent" x="1445" y="0" width="60" height="50" forecolor="#000000" backcolor="#FFFFFF"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="10" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA["фактична оплата замовника (грн.без ПДВ)"]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField-11" positionType="Float" stretchType="RelativeToTallestObject" mode="Transparent" x="1505" y="0" width="60" height="50" forecolor="#000000" backcolor="#FFFFFF"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="10" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA["Тип контрагента"]]></textFieldExpression>
			</textField>
		</band>
	</columnHeader>
	<detail>
		<band height="20" splitType="Stretch">
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField-2" style="qqq" positionType="Float" stretchType="RelativeToTallestObject" mode="Opaque" x="450" y="0" width="236" height="20"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="9" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{contragentname}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField-3" style="qqq" positionType="Float" stretchType="RelativeToTallestObject" mode="Opaque" x="220" y="0" width="60" height="20"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="9" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{contractnumberservices}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="#0.00" isBlankWhenNull="true">
				<reportElement key="textField-4" style="qqq" positionType="Float" stretchType="RelativeToTallestObject" mode="Opaque" x="1016" y="0" width="60" height="20"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="9" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{dohod}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="#0.00" isBlankWhenNull="true">
				<reportElement key="textField-5" style="qqq" positionType="Float" stretchType="RelativeToTallestObject" mode="Opaque" x="1076" y="0" width="60" height="20"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="9" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{rashod}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="#0.00" isBlankWhenNull="true">
				<reportElement key="textField-6" style="qqq" positionType="Float" stretchType="RelativeToTallestObject" mode="Opaque" x="1136" y="0" width="60" height="20"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="9" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{saldo}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField-16" style="qqq" positionType="Float" stretchType="RelativeToTallestObject" mode="Opaque" x="390" y="0" width="60" height="20"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="9" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{partnercode}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField-18" style="qqq" positionType="Float" stretchType="RelativeToTallestObject" mode="Opaque" x="0" y="0" width="60" height="20"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="8" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{actincodenumber}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField-20" style="qqq" positionType="Float" stretchType="RelativeToTallestObject" mode="Opaque" x="60" y="0" width="50" height="20"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="8" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{actincomedate}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField-22" style="qqq" positionType="Float" stretchType="RelativeToTallestObject" mode="Opaque" x="330" y="0" width="60" height="20"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="9" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{findoccode}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField-24" style="qqq" positionType="Float" stretchType="RelativeToTallestObject" mode="Opaque" x="686" y="0" width="100" height="20"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="9" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{depname}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField-26" style="qqq" positionType="Float" stretchType="RelativeToTallestObject" mode="Opaque" x="786" y="0" width="230" height="20"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="9" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{finworktypename}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="#0.00" isBlankWhenNull="true">
				<reportElement key="textField-6" style="qqq" positionType="Float" stretchType="RelativeToTallestObject" mode="Opaque" x="1196" y="0" width="80" height="20"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="9" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{rentab}]]></textFieldExpression>
			</textField>
			<subreport isUsingCache="true">
				<reportElement key="subreport-2" positionType="Float" isPrintRepeatedValues="false" mode="Opaque" x="1565" y="0" width="484" height="20">
					<printWhenExpression><![CDATA[new Boolean($P{showcalcul}.intValue() == 1 )]]></printWhenExpression>
				</reportElement>
				<parametersMapExpression><![CDATA[$P{REPORT_PARAMETERS_MAP}]]></parametersMapExpression>
				<subreportParameter name="elementcode">
					<subreportParameterExpression><![CDATA[$F{elementcode}]]></subreportParameterExpression>
				</subreportParameter>
				<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
				<subreportExpression><![CDATA[getClass().getResourceAsStream("/com/ksoe/energynet/reports/Services/ReportServicesBuh/calc.jasper")

/*"C:/Program Files (x86)/Jaspersoft/iReport-5.1.0/compile/calc.jasper"*/]]></subreportExpression>
			</subreport>
			<textField isStretchWithOverflow="true" pattern="#0.00" isBlankWhenNull="true">
				<reportElement key="textField-6" style="qqq" positionType="Float" stretchType="RelativeToTallestObject" mode="Opaque" x="1276" y="0" width="80" height="20"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="9" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{statusname}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField-20" style="qqq" positionType="Float" stretchType="RelativeToTallestObject" mode="Opaque" x="170" y="0" width="50" height="20"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="8" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{date_vik_work}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField-20" style="qqq" positionType="Float" stretchType="RelativeToTallestObject" mode="Opaque" x="280" y="0" width="50" height="20"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="8" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{contractdateservices}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="#0.00" isBlankWhenNull="true">
				<reportElement key="textField-6" style="qqq" positionType="Float" stretchType="RelativeToTallestObject" mode="Opaque" x="1356" y="0" width="89" height="20"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="9" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{dateact}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField-20" style="qqq" positionType="Float" stretchType="RelativeToTallestObject" mode="Opaque" x="110" y="0" width="60" height="20"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="8" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{dateposting}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="#0.00" isBlankWhenNull="true">
				<reportElement key="textField-6" style="qqq" positionType="Float" stretchType="RelativeToTallestObject" mode="Opaque" x="1445" y="0" width="60" height="20"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="9" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{sum_pay}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="#0.00" isBlankWhenNull="true">
				<reportElement key="textField-6" style="qqq" positionType="Float" stretchType="RelativeToTallestObject" mode="Opaque" x="1505" y="0" width="60" height="20"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="9" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{contragenttype}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<columnFooter>
		<band splitType="Stretch"/>
	</columnFooter>
	<pageFooter>
		<band splitType="Stretch"/>
	</pageFooter>
	<summary>
		<band height="20" splitType="Stretch">
			<textField isStretchWithOverflow="true" pattern="#0.00" isBlankWhenNull="true">
				<reportElement key="textField-12" positionType="Float" stretchType="RelativeToTallestObject" mode="Transparent" x="1016" y="0" width="60" height="20" forecolor="#000000" backcolor="#FFFFFF"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="9" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{itog_dohod}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="#0.00" isBlankWhenNull="true">
				<reportElement key="textField-13" positionType="Float" stretchType="RelativeToTallestObject" mode="Transparent" x="1076" y="0" width="60" height="20" forecolor="#000000" backcolor="#FFFFFF"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="9" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{itog_rashod}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="#0.00" isBlankWhenNull="true">
				<reportElement key="textField-14" positionType="Float" stretchType="RelativeToTallestObject" mode="Opaque" x="1136" y="0" width="60" height="20" forecolor="#000000" backcolor="#FFFFFF"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="9" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{itog_saldo}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="#0.00" isBlankWhenNull="true">
				<reportElement key="textField-14" positionType="Float" stretchType="RelativeToTallestObject" mode="Opaque" x="1196" y="0" width="80" height="20" forecolor="#000000" backcolor="#FFFFFF"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="9" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="timesbd.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[($V{itog_rashod}.doubleValue() != 0 ) ?
(
    ($V{itog_saldo}).divide($V{itog_rashod},6).multiply(new BigDecimal(100)).setScale(1, BigDecimal.ROUND_HALF_UP)
)
: new BigDecimal(0)]]></textFieldExpression>
			</textField>
		</band>
	</summary>
</jasperReport>

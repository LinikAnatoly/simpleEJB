<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="stateMaterials" pageWidth="2640" pageHeight="595" orientation="Landscape" whenNoDataType="AllSectionsNoDetail" columnWidth="2640" leftMargin="0" rightMargin="0" topMargin="0" bottomMargin="0" isIgnorePagination="true">
	<property name="ireport.scriptlethandling" value="0"/>
	<property name="ireport.encoding" value="UTF-8"/>
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<import value="net.sf.jasperreports.engine.*"/>
	<import value="java.util.*"/>
	<import value="net.sf.jasperreports.engine.data.*"/>
	<parameter name="startDate" class="java.lang.String">
		<defaultValueExpression><![CDATA[new String("01.02.2011")]]></defaultValueExpression>
	</parameter>
	<parameter name="endDate" class="java.lang.String">
		<defaultValueExpression><![CDATA[new String("28.02.2011")]]></defaultValueExpression>
	</parameter>
	<parameter name="budgcode" class="java.lang.String"/>
	<parameter name="rencode" class="java.lang.String"/>
	<parameter name="elementtypecode" class="java.lang.String"/>
	<parameter name="plancode" class="java.lang.String"/>
	<parameter name="renname" class="java.lang.String"/>
	<parameter name="budgname" class="java.lang.String"/>
	<parameter name="elementtypename" class="java.lang.String"/>
	<parameter name="komplekt" class="java.lang.Integer">
		<defaultValueExpression><![CDATA[new Integer(0)]]></defaultValueExpression>
	</parameter>
	<parameter name="elementcode" class="java.lang.String"/>
	<parameter name="formplancode" class="java.lang.String"/>
	<parameter name="strGroupmaterials" class="java.lang.String">
		<defaultValueExpression><![CDATA[new String("")]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[Select distinct object  , staterefcode ,  objectcode ,   depname ,  budgname , budgetrefcode , departmentrefcode from (


Select    (  select ed.ename ||' Инв.№'|| ed.invnumber from enelementdata ed where ed.ecode = elementrefcode )||
                 ' / (' || (select enplanworkstate.shortname from enplanworkstate , enplanwork
         where enplanworkstate.code =  staterefcode
          and  enplanwork.code = plancode
       )||')'  as object
       , staterefcode ,
         depname ,
         budgname ,
         objectcode ,
         prizn ,
         aaaa ,
         budgetrefcode ,
         departmentrefcode


 from (
select  enpl.kindcode    ,
        enit.code as eicode ,
        enit.countfact ,
        enit.materialrefcode ,
        tkm.name as materialname ,
        enpi.code ,
        tk.name as workname ,
        tk.techkartnumber ,
        tkmesu.name as namemeasure,
        enpl.elementrefcode,
        enpl.staterefcode ,
        enpl.code as plancode ,
        (select endepartment.name from endepartment  where endepartment.code = enpl.budgetrefcode ) as budgname,
        (select endepartment.name from endepartment  where endepartment.code = enpl.departmentrefcode ) as depname ,
        enpl.elementrefcode  as objectcode
        , enpl.budgetrefcode
        , enpl.departmentrefcode

 , case when enpl.kindcode = 2 then 1
        when enpl.kindcode = 3 then
        case
              /*если есть в месячном то не  берем План */
             when   coalesce(( select case when sum(en2en.countgen) > 0 then 999999
                                           when sum(en2en.countgen) is null then -1 else 0 end
                               from enestimateitem2nstmttm en2en where en2en.estimateitemoutrefcode = enit.code
                                and en2en.typerefcode = 1  ),0) > 0    then 0
             /* если нету в месячном  берем План  */
             when coalesce(( select case when sum(en2en.countgen) > 0 then 999999
                                         when sum(en2en.countgen) is null then -1 else 0 end
                               from enestimateitem2nstmttm en2en where en2en.estimateitemoutrefcode = enit.code
                                and en2en.typerefcode = 1  ),0) in ( -1 , 0 )   then 1
                                end

        when enpl.kindcode = 4 then
             /* если есть на месячном или на Плане то не берем */
        case  when ( coalesce(( select case when sum(en2en.countgen) > 0 then 999999
                                            when sum(en2en.countgen) is null then -1 else 0 end
                               from enestimateitem2nstmttm en2en where en2en.estimateitemoutrefcode = enit.code
                                and en2en.typerefcode = 1  ),0) > 0

                                or
                   coalesce(( select  case when sum(en2en.countgen) > 0 then 999999
                                           when sum(en2en.countgen) is null then -1 else 0 end
                               from enestimateitem2nstmttm en2en where en2en.estimateitemoutrefcode = (select en2en.estimateiteminrefcode from enestimateitem2nstmttm en2en where en2en.estimateitemoutrefcode = enit.code)
                                and en2en.typerefcode = 1  ),0) > 0
                    )   then 0  else 1
                                end

    end

      as prizn

      ,
      /*шифруем по комплектации -----------------------------------------------*/
      /* количество из движений */

 ( select coalesce(sum(countfact),0) from (
select cast(enit.code||' | '|| enpl.kindcode as varchar) as slujfield ,
        estimateitemcode  ,  countfact  , nomenclaturename , nomenclatureunitname  , partycode ,
        kindcode  , statusname ,   modify_time ,
        moloutcode , moloutname ,  prizn
 ,

        /*условие если партии не совпадают с приходом то объект не выводим */
 /* case when (
         select count(rqfkorderdata2fkparty.partycode)  from rqfkorderdata2fkparty
             where rqfkorderdata2fkparty.estimateitemrefcode = wwww.estimateitemcode
               and  rqfkorderdata2fkparty.partycode =  wwww.partycode

        ) > 0 then
         (select group_concat(obj.obj  ,';  ')

from (

select enelementdata.ename || ' Инв.№ ' ||enelementdata.invnumber as obj
  from enelementdata , enplanwork , enestimateitem
              where  enplanwork.elementrefcode = enelementdata.ecode
                and  enplanwork.code = enestimateitem.planrefcode
                and  enestimateitem.code =  wwww.estimateitemcode
                and  enestimateitem.statusrefcode in (1,2,3)

          union

          select enelementdata.ename || ' Инв.№ ' ||enelementdata.invnumber as obj
           from enestimateitem2nstmttm en2en , enestimateitem , enplanwork ,  enelementdata

                  where en2en.typerefcode in ( 2, 3 )
                    and en2en.estimateitemoutrefcode = wwww.estimateitemcode
                    and enestimateitem.code = en2en.estimateiteminrefcode
                    and enestimateitem.planrefcode = enplanwork.code
                    and enplanwork.elementrefcode = enelementdata.ecode
                    and enestimateitem.statusrefcode in (1,2,3)


                 ) obj)
         else ' ' end */
         ' '
                as objfactname
/*выбор фактического состояния материала */
     ,
      wwww.factstat  as factstatt
,

      ( select min(em1.monthgen)|| ' ' || min(em1.yeargen) from  enplanworkmovehistory em1
where em1.modify_time = (
  select min(em.modify_time)   from enplanworkmovehistory em where em.planrefcode in (
         select ep.code from enestimateitem e , enplanwork ep
           where e.planrefcode = ep.code
             and e.code = estimateitemcode )
             )
             ) as movedateplan
     from (

select  estimateitemcode  ,  sum(countfact) as countfact  , nomenclaturename , nomenclatureunitname  , partycode ,
        kindcode  , statusname ,   max(modify_time) as modify_time ,
        moloutcode , moloutname
      ,  f_analyse_motion(estimateitemcode  , sum(countfact) ,
                          nomenclaturename , nomenclatureunitname ,
                          partycode , kindcode , max(modify_time)  , kindcode ) as prizn , factstat
       from (

 /* << два юниона  на выборку приходов если проведеный то с партиями если нет то с нулевой партией .*/
              Select   fi2ei.modify_time   , fi2ei.estimateitemcode  , fi2ei.countgen as countfact ,  rqfkor.moloutcode ,
                       rqfkor.moloutname  , rqfkit.nomenclaturename , rqfkit.nomenclatureunitname
                       , rqfk2part.partycode ,  rqfkor.kindcode  ,rqfkorstatu.name as statusname ,
         case when rqfkor.kindcode = 1 and upper(rqfkorstatu.name) = 'СКЛАДЕНИЙ' then ' '

         when rqfkor.kindcode = 1 and upper(rqfkorstatu.name) = 'ПРОВЕДЕНИЙ'
                          then rqfkor.moloutcode||' '||rqfkor.moloutname
         when rqfkor.kindcode = 1 and upper(rqfkorstatu.name) = 'ПРОВЕДЕНИЙ ЯК ОЗ'
                          then  rqfkor.moloutcode||' '||rqfkor.moloutname
         else ' ' end  as factstat

               From  rqfkorderitem2enstmttm fi2ei , rqfkorderitem rqfkit ,  rqfkorder rqfkor
                   , rqfkorderdata2fkparty rqfk2part , rqfkorderstatus rqfkorstatu
              where fi2ei.estimateitemcode =  enit.code
                and rqfkit.code = fi2ei.fkorderitemrefcode
                and rqfkor.code = rqfkit.fkorderrefcode
                and rqfkor.kindcode = 1 /*Приходный ордер*/
                and rqfk2part.fkorderitemrefcode = rqfkit.code
                and rqfk2part.estimateitemrefcode = fi2ei.estimateitemcode
                and rqfkorstatu.code =  rqfkor.statuscode
                and rqfkorstatu.code in (4,3) /*для провуеденых приходов */
                and fi2ei.countgen <> 0 /* не учитываем нулевые приходы так как по нему уже было дальше движение */
                UNION
                Select   fi2ei.modify_time   , fi2ei.estimateitemcode  , fi2ei.countgen as countfact ,  rqfkor.moloutcode ,
                       rqfkor.moloutname  , rqfkit.nomenclaturename , rqfkit.nomenclatureunitname
                       , 0 as partycode ,  rqfkor.kindcode  ,rqfkorstatu.name as statusname ,
                       case when rqfkor.kindcode = 1 and upper(rqfkorstatu.name) = 'СКЛАДЕНИЙ' then ' '

         when rqfkor.kindcode = 1 and upper(rqfkorstatu.name) = 'ПРОВЕДЕНИЙ'
                          then rqfkor.moloutcode||' '||rqfkor.moloutname
         when rqfkor.kindcode = 1 and upper(rqfkorstatu.name) = 'ПРОВЕДЕНИЙ ЯК ОЗ'
                          then  rqfkor.moloutcode||' '||rqfkor.moloutname
         else ' ' end  as factstat


               From  rqfkorderitem2enstmttm fi2ei , rqfkorderitem rqfkit ,  rqfkorder rqfkor
                   ,  rqfkorderstatus rqfkorstatu
              where fi2ei.estimateitemcode = enit.code
                and rqfkit.code = fi2ei.fkorderitemrefcode
                and rqfkor.code = rqfkit.fkorderrefcode
                and rqfkor.kindcode = 1 /*Приходный ордер*/
                and rqfkorstatu.code =  rqfkor.statuscode
                and rqfkorstatu.code = 2  /*для  приходов  складеных */
                and fi2ei.countgen <> 0 /* не учитываем нулевые приходы так как по нему уже было дальше движение */

  UNION ALL

 Select  fi2ei.modify_time  , fi2ei.estimateitemcode  ,
          case when fin.statusrefcode  = 3 then /*если статус перенесен на другой план */
               (select  coalesce(sum(fin1.quantity), 0)
                  from finmaterials fin1
                 where fin1.estimateitemrefcode = enit.code
                   and fin1.parentrefcode in
                           (select fin.code from finmaterials fin where
                                   fin.estimateitemrefcode = enit.code and fin.statusrefcode = 3)
                   and   fin1.modify_time = (select max(fin3.modify_time)
                                               from finmaterials fin3
                                              where fin3.estimateitemrefcode = enit.code
                                                and fin3.parentrefcode in
                                                  (select fin4.code from finmaterials fin4
                                                    where fin4.estimateitemrefcode = enit.code
                                                      and fin4.statusrefcode = 3)
                            )
               )
                           else fin.quantity end as countfact ,
          rqfkor.moloutcode ,
          rqfkor.moloutname  , rqfkit.nomenclaturename , rqfkit.nomenclatureunitname
         , fin.party_id as partycode ,  rqfkor.kindcode ,rqfkorstatu.name as statusname ,

          /* для расходного ордера */
        case
         when kindcode = 2 and upper(rqfkorstatu.name) = 'СКЛАДЕНИЙ'
                          then  rqfkor.molincode||' '||rqfkor.molinname
         when kindcode = 2 and upper(rqfkorstatu.name) = 'ПРОВЕДЕНИЙ'
                          then  rqfkor.moloutcode||' '||rqfkor.moloutname
         when kindcode = 2 and upper(rqfkorstatu.name) = 'ПРОВЕДЕНИЙ ЯК ОЗ'
                          then  rqfkor.moloutcode||' '||rqfkor.moloutname
         else ' ' end as factstat


 from
   rqfkorderitem2enstmttm fi2ei, rqfkorderitem rqfkit ,  rqfkorder rqfkor
       ,  finmaterials fin  , rqfkorderstatus  rqfkorstatu
where fi2ei.estimateitemcode = enit.code
  and rqfkit.code = fi2ei.fkorderitemrefcode
  and rqfkor.code = rqfkit.fkorderrefcode
  and rqfkor.kindcode =2 /*Видатковий  ордер*/
  and fin.estimateitemrefcode = fi2ei.estimateitemcode
  and fin.code = fi2ei.finmaterialsrefcode
  and rqfkorstatu.code = rqfkor.statuscode
  and rqfkor.statuscode <> 1





  UNION ALL
  /*акты списание по месячным естимейтам  */

  Select  fin.modify_time as  modify_time ,  enit.code as estimateitemcode , fin.quantity as countfact  ,
  act.numbergen as moloutcode , to_char(act.dategen ,'dd.mm.yyyy') as moloutname ,
  fin.mat_name as nomenclaturename , fin.mu_name as nomenclatureunitname ,
  fin.party_id as partycode , 10 as kindcode , actstatu.name as statusname  ,
  case when act.statusrefcode = 3  then /* не показываем фактическое состояние материала если акт проведен */
    ' '
     else
     fin.div_code ||' '|| fin.div_name  end as factstat
    from enestimateitem2nstmttm enit2enit2 /*наличие материала на факте*/
, finmaterials fin , enestimateitem ene , enplanwork enp , enact2enplanwork act2wor ,
  enact act , enactstatus actstatu
 Where

   fin.estimateitemrefcode = enit2enit2.estimateitemoutrefcode
  /*убрали привязку к партии прихода */
  and  fin.estimateitemrefcode = ene.code
  and  ene.planrefcode = enp.code
  and  act2wor.plancode  =  enp.code
  and  act2wor.actrefcode = act.code
  and  fin.statusrefcode = 1 /*действительный*/
   /*and  act.statusrefcode = 3 проведенный в финколекции */
  and actstatu.code = act.statusrefcode





 and     enit2enit2.estimateiteminrefcode /*=*/ in  (
   Select enit2enit1.estimateitemoutrefcode from enestimateitem2nstmttm enit2enit1 /*наличие материала на плане*/
    Where enit2enit1.estimateiteminrefcode = enit.code )
 and (SELECT enpl.kindcode) = 2 /*если признак месячній  план */

    UNION ALL

      /*акты списание по естимейтем План  */

  Select  fin.modify_time as  modify_time , enit.code as estimateitemcode , fin.quantity as countfact  ,
  act.numbergen as moloutcode , to_char(act.dategen ,'dd.mm.yyyy') as moloutname ,
  fin.mat_name as nomenclaturename , fin.mu_name as nomenclatureunitname ,
  fin.party_id as partycode , 10 as kindcode , actstatu.name as statusname ,
  case when act.statusrefcode = 3  then  /*не показываем фактическое состояние материала если акт проведен*/
    ' '
     else
     fin.div_code ||' '|| fin.div_name  end as factstat
    from enestimateitem2nstmttm enit2enit2 /*наличие материала на факте*/
, finmaterials fin , enestimateitem ene , enplanwork enp , enact2enplanwork act2wor ,
  enact act , enactstatus actstatu
 Where

   fin.estimateitemrefcode = enit2enit2.estimateitemoutrefcode
  /*убрали привязку к партии прихода */
  and  fin.estimateitemrefcode = ene.code
  and  ene.planrefcode = enp.code
  and  act2wor.plancode  =  enp.code
  and  act2wor.actrefcode = act.code
  and  fin.statusrefcode = 1 /*действительный*/
  /* and  act.statusrefcode = 3 проведенный в финколекции*/
  and actstatu.code = act.statusrefcode

  and ( enit2enit2.estimateiteminrefcode = enit.code )
  and (SELECT enpl.kindcode) = 3 /*если признак задание план  */

   UNION ALL

      /*акты списание по естимейтем Факт  */

  Select  fin.modify_time as  modify_time ,  enit.code  as estimateitemcode , fin.quantity as countfact  ,
  act.numbergen as moloutcode , to_char(act.dategen ,'dd.mm.yyyy') as moloutname ,
  fin.mat_name as nomenclaturename , fin.mu_name as nomenclatureunitname ,
  fin.party_id as partycode , 10 as kindcode , actstatu.name as statusname ,
  case when act.statusrefcode = 3  then  /*не показываем фактическое состояние материала если акт проведен */
    ' '
     else
     fin.div_code ||' '|| fin.div_name  end as factstat
    from /*enestimateitem2nstmttm enit2enit2*/ /*наличие материала на факте*/
/*,*/ finmaterials fin , enestimateitem ene , enplanwork enp , enact2enplanwork act2wor ,
  enact act , enactstatus actstatu
 Where

   /*fin.estimateitemrefcode = enit2enit2.estimateitemoutrefcode*/
  /*убрали привязку к партии прихода */
  /*and*/  fin.estimateitemrefcode = ene.code
  and  ene.planrefcode = enp.code
  and  act2wor.plancode  =  enp.code
  and  act2wor.actrefcode = act.code
  and  fin.statusrefcode = 1 /*действительный*/
  /*and  act.statusrefcode = 3 проведенный в финколекции*/
  and actstatu.code = act.statusrefcode
  and ene.code = enit.code
  /*and ( enit2enit2.estimateitemoutrefcode = enit.code ) */
  and (SELECT enpl.kindcode)  = 4 /*если признак задание   факт */









  ) www




  Group by  estimateitemcode  ,  /*countfact ,*/ nomenclaturename , nomenclatureunitname  , partycode ,
           kindcode  ,statusname , moloutcode , moloutname , factstat


  ) wwww
  where ( prizn = 0 or kindcode = 10 )

UNION  /*======================================================================================*/


select cast(enit.code||' | '|| enpl.kindcode as varchar) as slujfield ,
       f.estimateitemrefcode as estimateitemcode , f.quantity as countfact ,
       f.mat_name as nomenclaturename  , f.mu_name as nomenclatureunitname ,
       coalesce(f.party_id,0) as partycode ,  0 as kindcode  , ' '  as statusname ,    0 as modify_time ,
       ' ' as moloutcode , 'Зарезерв. під акти' as  moloutname , 0 as prizn , ' ' as objfactname

       , f.div_code ||' '|| f.div_name  as factstatt
       , ( select min(em1.monthgen)|| ' ' || min(em1.yeargen) from  enplanworkmovehistory em1
where em1.modify_time = (
  select min(em.modify_time)   from enplanworkmovehistory em where em.planrefcode in (
         select ep.code from enestimateitem e , enplanwork ep
           where e.planrefcode = ep.code
             and e.code = estimateitemrefcode )
             )
             ) as movedateplan

from finmaterials f
where f.statusrefcode = 1
and f.code in (select fi.code  from finmaterials  fi
where fi.modify_time in (
select max(modify_time)   from finmaterials  f where f.statusrefcode = 1
and f.estimateitemrefcode in ( /*если с месячного задания то  развязаные материалы на плане и на факте */

select estimatecode from (
Select en2en.estimateitemoutrefcode as estimatecode
   from  enestimateitem2nstmttm en2en
   where en2en.estimateiteminrefcode = enit.code
     and  (SELECT enpl.kindcode)  = 2
UNION
Select en2en.estimateitemoutrefcode as estimatecode
   from  enestimateitem2nstmttm en2en
   where en2en.estimateiteminrefcode in ( Select en2en.estimateitemoutrefcode as estimatecode
                                                from  enestimateitem2nstmttm en2en
                                                where en2en.estimateiteminrefcode = enit.code )
     and (SELECT enpl.kindcode) = 2
) sel_if_month
UNION
/* если с задания План то развязаные материалы на плане и на факте */
select estimatecode from (
Select enit.code as estimatecode
where (SELECT enpl.kindcode) = 3
UNION
Select en2en.estimateitemoutrefcode as estimatecode
   from  enestimateitem2nstmttm en2en
   where en2en.estimateiteminrefcode = enit.code
     and  (SELECT enpl.kindcode) = 3


) sel_if_plan
UNION
/* если с задания Факт то развязаные материалы на факте и на плане */
select estimatecode from (
Select enit.code as estimatecode
where  (SELECT enpl.kindcode)  = 4
UNION
Select en2en.estimateiteminrefcode as estimatecode
   from  enestimateitem2nstmttm en2en
   where en2en.estimateitemoutrefcode = enit.code
     and  (SELECT enpl.kindcode) = 4


) sel_if_plan
    		    )

              group by   f.mat_id


       )  )


and ( /* ищем в ордерах */
    coalesce((
           Select coalesce(sum(countgen),0) from (
            Select  coalesce(sum(fi2ei.countgen),0) as  countgen
               From  rqfkorderitem2enstmttm fi2ei
              where fi2ei.estimateitemcode = enit.code
                and (SELECT enpl.kindcode) = 2 /*Мес*/
             UNION
              Select  coalesce(sum(fi2ei.countgen),0) as countgen
               From  rqfkorderitem2enstmttm fi2ei
              where fi2ei.estimateitemcode in (select en2en.estimateiteminrefcode from enestimateitem2nstmttm en2en
                                               where en2en.estimateitemoutrefcode  = enit.code )
                and (SELECT enpl.kindcode) = 3 /*план*/
              UNION
              Select  coalesce(sum(fi2ei.countgen),0) as countgen
               From  rqfkorderitem2enstmttm fi2ei
              where fi2ei.estimateitemcode in (select en2en.estimateiteminrefcode from  enestimateitem2nstmttm en2en
                                               where en2en.estimateitemoutrefcode in
                                                 (select estimateiteminrefcode from enestimateitem2nstmttm en2en
                                               where en2en.estimateitemoutrefcode  = enit.code
                                                 )
                                              )
                and (SELECT enpl.kindcode) = 4 /*факт*/
                ) selord

                 ),0) = 0

 And  /* ищем в актах */
                            (   select coalesce(sum(countfact),0)  from (
                          /*акты списание по месячным естимейтам  */
                          Select  fin.modify_time as  modify_time ,  enit.code as estimateitemcode , coalesce(fin.quantity,0) as countfact  ,
                          act.numbergen as moloutcode , to_char(act.dategen ,'dd.mm.yyyy') as moloutname ,
                          fin.mat_name as nomenclaturename , fin.mu_name as nomenclatureunitname ,
                          fin.party_id as partycode , 10 as kindcode , actstatu.name as statusname
                            from enestimateitem2nstmttm enit2enit2 /*наличие материала на факте*/
                        , finmaterials fin , enestimateitem ene , enplanwork enp , enact2enplanwork act2wor ,
                          enact act , enactstatus actstatu
                         Where

                           fin.estimateitemrefcode = enit2enit2.estimateitemoutrefcode
                          and  fin.estimateitemrefcode = ene.code
                          and  ene.planrefcode = enp.code
                          and  act2wor.plancode  =  enp.code
                          and  act2wor.actrefcode = act.code
                          and  fin.statusrefcode = 1 /*действительный*/
                          and actstatu.code = act.statusrefcode
                          and  enit2enit2.estimateiteminrefcode /*=*/ in  (
                           Select enit2enit1.estimateitemoutrefcode from enestimateitem2nstmttm enit2enit1 /*наличие материала на плане*/
                            Where enit2enit1.estimateiteminrefcode = enit.code )
                         and (SELECT enpl.kindcode) = 2 /*если признак месячній  план */

                            UNION

                              /*акты списание по естимейтем План  */

                          Select  fin.modify_time as  modify_time , enit.code as estimateitemcode , coalesce(fin.quantity,0) as countfact  ,
                          act.numbergen as moloutcode , to_char(act.dategen ,'dd.mm.yyyy') as moloutname ,
                          fin.mat_name as nomenclaturename , fin.mu_name as nomenclatureunitname ,
                          fin.party_id as partycode , 10 as kindcode , actstatu.name as statusname
                            from enestimateitem2nstmttm enit2enit2 /*наличие материала на факте*/
                        , finmaterials fin , enestimateitem ene , enplanwork enp , enact2enplanwork act2wor ,
                          enact act , enactstatus actstatu
                         Where

                           fin.estimateitemrefcode = enit2enit2.estimateitemoutrefcode

                          and  fin.estimateitemrefcode = ene.code
                          and  ene.planrefcode = enp.code
                          and  act2wor.plancode  =  enp.code
                          and  act2wor.actrefcode = act.code
                          and  fin.statusrefcode = 1 /*действительный*/
                          and actstatu.code = act.statusrefcode

                          and ( enit2enit2.estimateiteminrefcode = enit.code )
                          and (SELECT enpl.kindcode) = 3 /*если признак задание план  */

                           UNION

                              /*акты списание по естимейтем Факт  */

                          Select  fin.modify_time as  modify_time , enit.code  as estimateitemcode , coalesce(fin.quantity,0) as countfact  ,
                          act.numbergen as moloutcode , to_char(act.dategen ,'dd.mm.yyyy') as moloutname ,
                          fin.mat_name as nomenclaturename , fin.mu_name as nomenclatureunitname ,
                          fin.party_id as partycode , 10 as kindcode , actstatu.name as statusname
                            from /*enestimateitem2nstmttm enit2enit2*/ /*наличие материала на факте*/
                       /* , */ finmaterials fin , enestimateitem ene , enplanwork enp , enact2enplanwork act2wor ,
                          enact act , enactstatus actstatu
                         Where

                          /* fin.estimateitemrefcode = enit2enit2.estimateitemoutrefcode
                          and */  fin.estimateitemrefcode = ene.code
                          and  ene.planrefcode = enp.code
                          and  act2wor.plancode  =  enp.code
                          and  act2wor.actrefcode = act.code
                          and  fin.statusrefcode = 1 /*действительный*/
                          and actstatu.code = act.statusrefcode
                          and ene.code = enit.code
                          /*and ( enit2enit2.estimateitemoutrefcode = enit.code ) */
                          and (SELECT enpl.kindcode)  = 4 /*если признак задание   факт */


                          ) selact

     ) = 0

 )
) selcountfact)
   as aaaa

      /*конец шифруем по комплектации */




 from enestimateitem enit left join enplanworkitem enpi on (enit.planitemrefcode = enpi.code)
                                  left join tktechcard tk on (enpi.kartarefcode = tk.code ) ,
     enplanwork enpl ,
     tkmaterials tkm ,
     tkmeasurement tkmesu  ,

                  ( Select   enplanwork.code  from enelement , enplanwork
                     Where   enelement.code = enplanwork.elementrefcode
                       and enplanwork.datestart between to_date($P{startDate},'dd.mm.yyyy') and  to_date($P{endDate},'dd.mm.yyyy')
                       and ( enelement.typerefcode = $P!{elementtypecode} or 0 = $P!{elementtypecode} )
                       and ( enplanwork.budgetrefcode = $P!{budgcode}  or 0 = $P!{budgcode} )
                       and ( enplanwork.departmentrefcode = $P!{rencode} or 0 = $P!{rencode} )
                       and ( enplanwork.code = $P!{plancode}  or  0 = $P!{plancode} )
                       and ( enplanwork.elementrefcode = $P!{elementcode} or  0 = $P!{elementcode} )
                       and ( enplanwork.formrefcode = $P!{formplancode} or 0 = $P!{formplancode} )
                   ) codeplonelement

 where codeplonelement.code = enpl.code
   and enit.planrefcode = enpl.code
   and enit.kindrefcode = 1 /*только материалы*/
   and enit.statusrefcode in (1,2,3)
   and enit.countfact <> 0
   and enpl.kindcode <> 1 /*не учитываем годовые планы */
   and tkm.code = enit.materialrefcode
   and tkmesu.code = tkm.measurementcode


      /* группа материалов или конкретный материал */

    and  tkm.code in
                  (select tm.code from tkmaterials tm
                   where $P!{strGroupmaterials}
                  )



  group by enit.code ,  enit.materialrefcode   , enpl.kindcode , tkm.name , enpi.code   , tk.name ,  enit.countfact ,
           tk.techkartnumber  , tkmesu.name ,  enpl.elementrefcode, enpl.staterefcode ,  enpl.code , tkm.name
           , enpl.budgetrefcode , enpl.departmentrefcode
  order by materialrefcode , enpl.kindcode

   ) selsprizn

   where prizn = 1

   /*проверка недоукоплектованых или переукомплектованих материалов*/
    and
     (
          ( (select $P!{komplekt}  ) = (select 0) )
          or
          ( ( (select $P!{komplekt}  ) = (select 1) ) and (selsprizn.countfact > selsprizn.aaaa) )
          or
          ( (  (select $P!{komplekt} ) = (select 2) ) and (selsprizn.countfact < selsprizn.aaaa) )
          or
          ( (  (select $P!{komplekt} ) = (select 3) ) and (selsprizn.countfact = selsprizn.aaaa) )
     )
   )
   selnotdist

       order by depname , budgname , object]]>
	</queryString>
	<field name="object" class="java.lang.String"/>
	<field name="objectcode" class="java.lang.Integer"/>
	<field name="depname" class="java.lang.String"/>
	<field name="budgname" class="java.lang.String"/>
	<field name="staterefcode" class="java.lang.Integer"/>
	<field name="budgetrefcode" class="java.lang.String"/>
	<field name="departmentrefcode" class="java.lang.String"/>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="50" splitType="Stretch">
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField-29" stretchType="RelativeToTallestObject" x="230" y="18" width="1100" height="32"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" isBold="true" pdfFontName="times.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[" Фактичне знаходження матеріалів по об`єктам " + "\n" +
" з " +  $P{startDate} + " по " +  $P{endDate} + "\n"
 +  new String($P{renname}.equals("0") ? " " :  "\n" + " Підрозділ : " +  $P{renname}  )
 +  new String($P{budgname}.equals("0") ? " " :  "\n" + " Бюджетоотримувач : " + $P{budgname}  )
 +  new String($P{elementtypename}.equals("0") ? " " :  "\n" +  " Тип об`єкту : " +  $P{elementtypename}  )]]></textFieldExpression>
			</textField>
			<textField pattern="" isBlankWhenNull="false">
				<reportElement key="textField-31" x="1430" y="18" width="300" height="32"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement>
					<font fontName="Times New Roman" size="10" pdfFontName="Times-Roman" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
				</textElement>
				<textFieldExpression><![CDATA[new Date()]]></textFieldExpression>
			</textField>
		</band>
	</title>
	<pageHeader>
		<band splitType="Stretch"/>
	</pageHeader>
	<columnHeader>
		<band height="50" splitType="Stretch">
			<textField isBlankWhenNull="false">
				<reportElement key="textField-1" stretchType="RelativeToTallestObject" x="30" y="0" width="1300" height="20"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" isBold="true" pdfFontName="times.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA["Матеріали з планів "]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="false">
				<reportElement key="textField-2" stretchType="RelativeToTallestObject" x="0" y="0" width="30" height="50"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="8" isBold="true" pdfFontName="times.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA["№з.п"]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="false">
				<reportElement key="textField-3" stretchType="RelativeToTallestObject" x="430" y="20" width="300" height="30"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="10" isBold="true" pdfFontName="times.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA["Об`єкт плану / (Тип акту)"]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="false">
				<reportElement key="textField-4" stretchType="RelativeToTallestObject" x="730" y="20" width="320" height="30"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="10" isBold="true" pdfFontName="times.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA["Робота"]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="false">
				<reportElement key="textField-5" stretchType="RelativeToTallestObject" x="1050" y="20" width="200" height="30"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="10" isBold="true" pdfFontName="times.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA["Найменування матеріалу"]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="false">
				<reportElement key="textField-6" stretchType="RelativeToTallestObject" x="1250" y="20" width="40" height="30"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="10" isBold="true" pdfFontName="times.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA["Од.вим"]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="false">
				<reportElement key="textField-7" stretchType="RelativeToTallestObject" x="1290" y="20" width="40" height="30"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="10" isBold="true" pdfFontName="times.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA["Кількість"]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="false">
				<reportElement key="textField-13" stretchType="RelativeToTallestObject" mode="Transparent" x="1530" y="20" width="200" height="30" backcolor="#EFEDED"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Times New Roman" size="10" isBold="true" pdfFontName="times.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
				</textElement>
				<textFieldExpression><![CDATA["Найменування матеріалу"]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="false">
				<reportElement key="textField-14" stretchType="RelativeToTallestObject" mode="Transparent" x="1730" y="20" width="60" height="30" backcolor="#EFEDED"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Times New Roman" size="10" isBold="true" pdfFontName="times.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
				</textElement>
				<textFieldExpression><![CDATA["Од.вим"]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="false">
				<reportElement key="textField-15" stretchType="RelativeToTallestObject" mode="Transparent" x="1790" y="20" width="60" height="30" backcolor="#EFEDED"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Times New Roman" size="10" isBold="true" pdfFontName="times.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
				</textElement>
				<textFieldExpression><![CDATA["Кількість"]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="false">
				<reportElement key="textField-16" stretchType="RelativeToTallestObject" mode="Transparent" x="1850" y="20" width="60" height="30" backcolor="#EFEDED"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Times New Roman" size="10" isBold="true" pdfFontName="times.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
				</textElement>
				<textFieldExpression><![CDATA["Код МВО/ №Акту"]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="false">
				<reportElement key="textField-17" stretchType="RelativeToTallestObject" mode="Transparent" x="1910" y="20" width="150" height="30" backcolor="#EFEDED"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Times New Roman" size="10" isBold="true" pdfFontName="times.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
				</textElement>
				<textFieldExpression><![CDATA["Назва МВО / Дата акту"]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="false">
				<reportElement key="textField-18" stretchType="RelativeToTallestObject" x="1330" y="0" width="1300" height="20"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="10" isBold="true" pdfFontName="times.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[" Фактичний стан / знаходження матеріалу "]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="false">
				<reportElement key="textField-25" stretchType="RelativeToTallestObject" mode="Transparent" x="1330" y="20" width="100" height="30" isPrintWhenDetailOverflows="true" backcolor="#EFEDED"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Times New Roman" size="10" isBold="true" pdfFontName="times.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
				</textElement>
				<textFieldExpression><![CDATA["Номер заявки"]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="false">
				<reportElement key="textField-26" stretchType="RelativeToTallestObject" mode="Transparent" x="2060" y="20" width="50" height="30" isPrintWhenDetailOverflows="true" backcolor="#EFEDED"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Times New Roman" size="10" isBold="true" pdfFontName="times.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
				</textElement>
				<textFieldExpression><![CDATA["Код партії"]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="false">
				<reportElement key="textField-32" stretchType="RelativeToTallestObject" x="30" y="20" width="200" height="30"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="10" isBold="true" pdfFontName="times.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[" Підрозділ "]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="false">
				<reportElement key="textField-34" stretchType="RelativeToTallestObject" x="230" y="20" width="200" height="30"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="10" isBold="true" pdfFontName="times.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA["Бюджетотримач"]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="false">
				<reportElement key="textField-36" stretchType="RelativeToTallestObject" mode="Transparent" x="2250" y="20" width="80" height="30" isPrintWhenDetailOverflows="true" backcolor="#EFEDED"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Times New Roman" size="10" isBold="true" pdfFontName="times.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
				</textElement>
				<textFieldExpression><![CDATA["Статус документа"]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="false">
				<reportElement key="textField-37" stretchType="RelativeToTallestObject" mode="Transparent" x="2330" y="20" width="200" height="30" isPrintWhenDetailOverflows="true" backcolor="#EFEDED"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Times New Roman" size="10" isBold="true" pdfFontName="times.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
				</textElement>
				<textFieldExpression><![CDATA[" Фактичне знаходження "]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="false">
				<reportElement key="textField-38" stretchType="RelativeToTallestObject" mode="Transparent" x="2530" y="20" width="100" height="30" isPrintWhenDetailOverflows="true" backcolor="#EFEDED"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Times New Roman" size="10" isBold="true" pdfFontName="times.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
				</textElement>
				<textFieldExpression><![CDATA["Місяць/рік з якого перенесений план"]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="false">
				<reportElement key="textField-39" stretchType="RelativeToTallestObject" mode="Transparent" x="1430" y="20" width="100" height="30" isPrintWhenDetailOverflows="true" backcolor="#EFEDED"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Times New Roman" size="10" isBold="true" pdfFontName="times.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
				</textElement>
				<textFieldExpression><![CDATA["Період заявки"]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="false">
				<reportElement key="textField-40" stretchType="RelativeToTallestObject" mode="Transparent" x="2110" y="20" width="70" height="30" isPrintWhenDetailOverflows="true" backcolor="#EFEDED"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Times New Roman" size="10" isBold="true" pdfFontName="times.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
				</textElement>
				<textFieldExpression><![CDATA["Номер документу "]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="false">
				<reportElement key="textField-41" stretchType="RelativeToTallestObject" mode="Transparent" x="2180" y="20" width="70" height="30" isPrintWhenDetailOverflows="true" backcolor="#EFEDED"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Times New Roman" size="10" isBold="true" pdfFontName="times.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
				</textElement>
				<textFieldExpression><![CDATA["Дата документу"]]></textFieldExpression>
			</textField>
		</band>
	</columnHeader>
	<detail>
		<band height="20" splitType="Stretch">
			<frame>
				<reportElement key="frame-1" stretchType="RelativeToBandHeight" x="730" y="0" width="1760" height="20"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
			</frame>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField-24" stretchType="RelativeToTallestObject" x="0" y="0" width="30" height="20" isPrintWhenDetailOverflows="true"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="8" isBold="true" pdfFontName="times.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{REPORT_COUNT}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField-30" stretchType="RelativeToTallestObject" mode="Transparent" x="430" y="0" width="300" height="20" isPrintWhenDetailOverflows="true"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="8" isBold="true" pdfFontName="times.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{object}]]></textFieldExpression>
			</textField>
			<subreport isUsingCache="true">
				<reportElement key="subreport-1" stretchType="RelativeToTallestObject" x="730" y="0" width="1900" height="20"/>
				<subreportParameter name="startDate">
					<subreportParameterExpression><![CDATA[$P{startDate}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="endDate">
					<subreportParameterExpression><![CDATA[$P{endDate}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="budgcode">
					<subreportParameterExpression><![CDATA[$F{budgetrefcode}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="rencode">
					<subreportParameterExpression><![CDATA[$F{departmentrefcode}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="elementtypecode">
					<subreportParameterExpression><![CDATA[$P{elementtypecode}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="plancode">
					<subreportParameterExpression><![CDATA[$P{plancode}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="elementcode">
					<subreportParameterExpression><![CDATA[$F{objectcode}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="staterefcode">
					<subreportParameterExpression><![CDATA[$F{staterefcode}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="komplekt">
					<subreportParameterExpression><![CDATA[$P{komplekt}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="formplancode">
					<subreportParameterExpression><![CDATA[$P{formplancode}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="strGroupmaterials">
					<subreportParameterExpression><![CDATA[$P{strGroupmaterials}]]></subreportParameterExpression>
				</subreportParameter>
				<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
				<subreportExpression><![CDATA[/*"C:/iReport-3.0.0/tmp/stateMaterialsByObject.jasper"*/
getClass().getResourceAsStream("/com/ksoe/energynet/reports/material/state/stateMaterialsByObject.jasper")]]></subreportExpression>
			</subreport>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField-33" stretchType="RelativeToTallestObject" mode="Transparent" x="30" y="0" width="200" height="20" isPrintWhenDetailOverflows="true"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="10" isBold="true" pdfFontName="times.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{depname}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField-35" stretchType="RelativeToTallestObject" mode="Transparent" x="230" y="0" width="200" height="20" isPrintWhenDetailOverflows="true"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="8" isBold="true" pdfFontName="times.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{budgname}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<columnFooter>
		<band splitType="Stretch"/>
	</columnFooter>
	<pageFooter>
		<band splitType="Stretch"/>
	</pageFooter>
	<summary>
		<band splitType="Stretch"/>
	</summary>
</jasperReport>

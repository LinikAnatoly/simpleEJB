<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="positionTimeNorms_2" pageWidth="595" pageHeight="842" columnWidth="595" leftMargin="0" rightMargin="0" topMargin="0" bottomMargin="0">
	<property name="ireport.scriptlethandling" value="0"/>
	<property name="ireport.encoding" value="UTF-8"/>
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<import value="net.sf.jasperreports.engine.*"/>
	<import value="java.util.*"/>
	<import value="net.sf.jasperreports.engine.data.*"/>
	<parameter name="monthGen" class="java.lang.Integer">
		<defaultValueExpression><![CDATA[new Integer(0)]]></defaultValueExpression>
	</parameter>
	<parameter name="yearGen" class="java.lang.Integer">
		<defaultValueExpression><![CDATA[new Integer(0)]]></defaultValueExpression>
	</parameter>
	<parameter name="renCode" class="java.lang.Integer">
		<defaultValueExpression><![CDATA[new Integer(0)]]></defaultValueExpression>
	</parameter>
	<parameter name="budgCode" class="java.lang.Integer">
		<defaultValueExpression><![CDATA[new Integer(0)]]></defaultValueExpression>
	</parameter>
	<parameter name="pKindCode" class="java.lang.Integer">
		<defaultValueExpression><![CDATA[new Integer(1)]]></defaultValueExpression>
	</parameter>
	<parameter name="elementCode" class="java.lang.Integer" isForPrompting="false"/>
	<queryString>
		<![CDATA[select

  positionName,
  razryad,
  sum((norm_time / wcount) * wcount_position * countgen) as sumTime from (
 select pos.name as positionName , pos.rank as razryad , tk.normoftime as norm_time
       , tk2.kolvo as wcount_position , pi.countgen
       , ( select sum(tk22.kolvo) From
    tkelement2techcard tk22  ,  tkelement tee
    Where tk22.elementcode = tee.code
      and tee.elementtypecode = 240000001
      and  tk22.techkartcode = tk.code  ) as wcount  from
 enplanwork p , enplanworkitem pi , endepartment d , endepartment db ,
 tktechcard tk , tkelement2techcard tk2 , tkelement tke ,  tkposition pos , enelement e
 where p.code = pi.planrefcode
   and d.code = p.departmentrefcode
   and db.code = p.budgetrefcode
   and p.yeargen = $P{yearGen}
   and p.monthgen = $P{monthGen}
   and p.statuscode not in (2,6)
   and pi.kartarefcode = tk.code
   and tk.code = tk2.techkartcode
   and tk2.elementcode = tke.code
   and tke.elementtypecode = 240000001
   and tke.code = pos.elementcode
   and p.elementrefcode = e.code
   -- and p.code = 75000441
   and ( p.departmentrefcode = $P{renCode}  or $P{renCode}  = 0 )
   and ( p.budgetrefcode = $P{budgCode} or $P{budgCode} = 0 )
   and ((p.statuscode = 1) or (p.statuscode = 3) or (p.statuscode = 7) ) /*черновики(1) и утвержденные(3) */
   and p.kindcode = $P{pKindCode} /* годовой(1) или текущий(2) или нпз(3) или Факт(4) */
   and ( e.code = $P{elementCode} or $P{elementCode} = 0)
   ) as q where wcount <> 0
group by
   positionName , razryad
order by
   positionName, razryad]]>
	</queryString>
	<field name="positionname" class="java.lang.String"/>
	<field name="razryad" class="java.lang.String"/>
	<field name="sumtime" class="java.lang.Double"/>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="30" splitType="Stretch">
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField-5" mode="Opaque" x="0" y="0" width="388" height="30" forecolor="#000000" backcolor="#999999"/>
				<box topPadding="1" leftPadding="1" bottomPadding="1" rightPadding="1">
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="10" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="times.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA["Посада"]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField-6" mode="Opaque" x="388" y="0" width="78" height="30" forecolor="#000000" backcolor="#999999"/>
				<box topPadding="1" leftPadding="1" bottomPadding="1" rightPadding="1">
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="10" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="times.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA["Розряд"]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="###0.00" isBlankWhenNull="true">
				<reportElement key="textField-8" mode="Opaque" x="466" y="0" width="69" height="30" forecolor="#000000" backcolor="#999999"/>
				<box topPadding="1" leftPadding="1" bottomPadding="1" rightPadding="1">
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None">
					<font fontName="Times New Roman" size="10" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="times.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA["Трудовитрати, люд./год"]]></textFieldExpression>
			</textField>
		</band>
	</title>
	<pageHeader>
		<band splitType="Stretch"/>
	</pageHeader>
	<columnHeader>
		<band splitType="Stretch"/>
	</columnHeader>
	<detail>
		<band height="17" splitType="Stretch">
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField-1" mode="Opaque" x="0" y="0" width="388" height="17" forecolor="#000000" backcolor="#FFFFFF"/>
				<box topPadding="1" leftPadding="1" bottomPadding="1" rightPadding="1">
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement verticalAlignment="Top" rotation="None">
					<font fontName="Times New Roman" size="10" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="times.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{positionname}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField-2" mode="Opaque" x="388" y="0" width="78" height="17" forecolor="#000000" backcolor="#FFFFFF"/>
				<box topPadding="1" leftPadding="1" bottomPadding="1" rightPadding="1">
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement verticalAlignment="Top" rotation="None">
					<font fontName="Times New Roman" size="10" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="times.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{razryad}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="###0.00" isBlankWhenNull="true">
				<reportElement key="textField-4" mode="Opaque" x="466" y="0" width="69" height="17" forecolor="#000000" backcolor="#FFFFFF"/>
				<box topPadding="1" leftPadding="1" bottomPadding="1" rightPadding="1">
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement verticalAlignment="Top" rotation="None">
					<font fontName="Times New Roman" size="10" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="times.ttf" pdfEncoding="Cp1251" isPdfEmbedded="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{sumtime}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<columnFooter>
		<band splitType="Stretch"/>
	</columnFooter>
	<pageFooter>
		<band splitType="Stretch"/>
	</pageFooter>
	<summary>
		<band splitType="Stretch"/>
	</summary>
</jasperReport>
